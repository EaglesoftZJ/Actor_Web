{"version":3,"sources":["../../../src/components/activity/UserProfile.react.js"],"names":["UserProfile","getStores","calculateState","prevState","nextProps","uid","user","id","peer","getUser","isNotificationsEnabled","message","getMessage","department","getState","props","onNotificationChange","bind","handleAvatarClick","event","state","changeNotificationsEnabled","target","checked","open","bigAvatar","renderInfo","yh_data","totalInfo","from","where","toArray","renderAbout","about","__html","replace","renderToggleContact","isContact","onAddToContacts","renderBlockUser","context","delegate","features","blocking","onBlockUser","render","placeholder","name","contextTypes","object","isRequired","propTypes","create","withProps","pure"],"mappings":"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","file":"UserProfile.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport { Container } from 'flux/utils';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { lightbox } from '../../utils/ImageUtils';\r\nimport linq from 'Linq';\r\n\r\nimport { escapeWithEmoji } from '../../utils/EmojiUtils';\r\n\r\nimport NotificationsActionCreators from '../../actions/NotificationsActionCreators';\r\n\r\nimport UserStore from '../../stores/UserStore';\r\nimport NotificationsStore from '../../stores/NotificationsStore';\r\nimport OnlineStore from '../../stores/OnlineStore';\r\nimport DepartmentStore from '../../stores/DepartmentStore';\r\n\r\nimport AvatarItem from '../common/AvatarItem.react';\r\nimport ContactDetails from '../common/ContactDetails.react';\r\nimport ToggleNotifications from '../common/ToggleNotifications.react';\r\n\r\nclass UserProfile extends Component {\r\n  static contextTypes = {\r\n    delegate: PropTypes.object.isRequired\r\n  };\r\n\r\n  static propTypes = {\r\n    user: PropTypes.object.isRequired\r\n  };\r\n\r\n  static getStores() {\r\n    return [NotificationsStore, OnlineStore];\r\n  }\r\n\r\n  static calculateState(prevState, nextProps) {\r\n    const uid = nextProps.user.id;\r\n    const peer = uid ? UserStore.getUser(uid) : null;\r\n\r\n    return {\r\n      ...prevState,\r\n      peer,\r\n      isNotificationsEnabled: peer ? NotificationsStore.isNotificationsEnabled(peer) : true,\r\n      message: OnlineStore.getMessage(),\r\n      department: DepartmentStore.getState()\r\n    };\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.onNotificationChange = this.onNotificationChange.bind(this);\r\n    this.handleAvatarClick = this.handleAvatarClick.bind(this);\r\n  }\r\n\r\n  onNotificationChange(event) {\r\n    const { peer } = this.state;\r\n    NotificationsActionCreators.changeNotificationsEnabled(peer, event.target.checked);\r\n  }\r\n\r\n  handleAvatarClick() {\r\n    lightbox.open(this.props.user.bigAvatar)\r\n  }\r\n\r\n  renderInfo() {\r\n    const { user } = this.props;\r\n    const { yh_data } = this.state.department;\r\n    let totalInfo = linq.from(yh_data).where('parseFloat($.IGIMID) == ' + user.id).toArray()[0];\r\n    return <ContactDetails peerInfo={{...user, ...totalInfo}}/>;\r\n  }\r\n\r\n  renderAbout() {\r\n    const { about } = this.props.user;\r\n    if (!about) return null;\r\n\r\n    return (\r\n      <div\r\n        className=\"user_profile__meta__about\"\r\n        dangerouslySetInnerHTML={{ __html: escapeWithEmoji(about).replace(/\\n/g, '<br/>') }}/>\r\n    )\r\n  }\r\n\r\n  renderToggleContact() {\r\n    const { isContact } = this.props.user;\r\n\r\n    if (isContact) {\r\n      return null;\r\n      // (\r\n      //   <li className=\"dropdown__menu__item\" onClick={this.onRemoveFromContacts}>\r\n      //     <FormattedMessage id=\"removeFromContacts\"/>\r\n      //   </li>\r\n      // );\r\n    }\r\n\r\n    return (\r\n      <li className=\"dropdown__menu__item\" onClick={this.onAddToContacts}>\r\n        <FormattedMessage id=\"addToContacts\"/>\r\n      </li>\r\n    );\r\n  }\r\n\r\n  renderBlockUser() {\r\n    if (!this.context.delegate.features.blocking) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <li className=\"dropdown__menu__item\" onClick={this.onBlockUser}>\r\n        <FormattedMessage id=\"blockUser\"/>\r\n      </li>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { user } = this.props;\r\n    const { isNotificationsEnabled, message } = this.state;\r\n\r\n    return (\r\n      <div className=\"activity__body user_profile\">\r\n\r\n        <ul className=\"profile__list\">\r\n          <li className=\"profile__list__item user_profile__meta\">\r\n            <header>\r\n              <AvatarItem\r\n                className=\"profile__avatar\"\r\n                size=\"large\"\r\n                image={user.bigAvatar}\r\n                placeholder={user.placeholder}\r\n                title={user.name}\r\n                onClick={this.handleAvatarClick}\r\n              />\r\n\r\n              <h3 className=\"user_profile__meta__title\" dangerouslySetInnerHTML={{ __html: escapeWithEmoji(user.name) }}/>\r\n              <div className=\"user_profile__meta__message\">{message}</div>\r\n            </header>\r\n\r\n            {/* {this.renderAbout()} */}\r\n          </li>\r\n          <li className=\"profile__list__item user_profile__contact_info no-p\">\r\n            { this.renderInfo() }\r\n          </li>\r\n\r\n          <li className=\"profile__list__item user_profile__notifications no-p\">\r\n            <ToggleNotifications\r\n              isNotificationsEnabled={isNotificationsEnabled}\r\n              onNotificationChange={this.onNotificationChange}/>\r\n          </li>\r\n\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Container.create(UserProfile, { withProps: true, pure: false });\r\n"]}