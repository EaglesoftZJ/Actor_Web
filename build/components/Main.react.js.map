{"version":3,"sources":["../../src/components/Main.react.js"],"names":["Main","props","onVisibilityChange","isNotTj","console","log","document","hidden","createAppHidden","createAppVisible","components","getComponents","get","Sidebar","sidebar","Toolbar","toolbar","componentWillMount","isElectron","componentDidMount","window","messenger","listenOnRender","event","arg","push","setLoggedOut","show","title","type","key","Date","getTime","info","getState","profile","name","id","spapdata","rid","method","ajax","url","data","beforeSend","request","setRequestHeader","success","res","getDialogStore","addEventListener","componentWillUnmount","removeEventListener","handleEletronEr","isLoggedIn","main","login","sendToElectron","getProfile","setDialogs","handleVisible","visibilityState","renderCall","features","calls","handleClick","render","children","propTypes","params","object","oneOfType","arrayOf","node"],"mappings":"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","file":"Main.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\nimport { isFunction } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport DelegateContainer from '../utils/DelegateContainer';\n\nimport VisibilityActionCreators from '../actions/VisibilityActionCreators';\nimport LoginActionCreators from '../actions/LoginActionCreators';\nimport MessageAlertActionCreators from '../actions/MessageAlertActionCreators';\nimport DialogActionCreators from '../actions/DialogActionCreators';\n\nimport DefaultSidebar from './Sidebar.react';\nimport DefaultToolbar from './Toolbar.react';\nimport ConnectionState from './common/ConnectionState.react';\nimport Favicon from './common/Favicon.react';\nimport Department from './Department.react';\nimport ModalsWrapper from './modals/ModalsWrapper.react';\nimport MenuOverlay from './common/MenuOverlay.react';\nimport SmallCall from './SmallCall.react';\nimport MessageAlert from './common/MessageAlert.react';\n\nimport LoginStore from '../stores/LoginStore';\nimport ProfileStore from '../stores/ProfileStore';\n\nimport loading from '../utils/DataLoading';\nimport ActorClient from '../utils/ActorClient';\nimport { prepareTextMessage } from '../utils/MessageUtils';\n\nimport history from '../utils/history';\nimport { setTimeout } from 'timers';\nimport $ from 'jquery';\n\nclass Main extends Component {\n  static propTypes = {\n    params: PropTypes.object,\n    children: PropTypes.oneOfType([\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ])\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.components = this.getComponents();\n  }\n\n  getComponents() {\n    const { components } = DelegateContainer.get();\n\n    if (components) {\n      return {\n        Sidebar: isFunction(components.sidebar) ? components.sidebar : DefaultSidebar,\n        Toolbar: isFunction(components.toolbar) ? components.toolbar : DefaultToolbar\n      };\n    }\n\n    return {\n      Sidebar: DefaultSidebar,\n      Toolbar: DefaultToolbar\n    };\n  }\n  componentWillMount() {\n    if (ActorClient.isElectron()) {\n      // this.handleEletronEr();\n    }\n  }\n\n  componentDidMount() {\n    // 测试\n\n    this.onVisibilityChange(true);\n    if (ActorClient.isElectron()) {\n      window.messenger.listenOnRender('windows-blur', function(event, arg) {\n        history.push('/im');\n      })\n\n      window.messenger.listenOnRender('windows-focus', (event, arg) => {\n        VisibilityActionCreators.createAppVisible(); // 客户端中 web无法监听到visibilitychange事件 所以通过客户端的windows-focus来执行\n        history.push(`/im/${arg}`);\n      });\n\n\n      window.messenger.listenOnRender('setLoggedOut', function(event, arg) {\n        if (ActorClient.isElectron()) {\n          LoginActionCreators.setLoggedOut();\n        }\n      })\n      window.messenger.listenOnRender('downloadCompleted', function(event, arg) {\n        MessageAlertActionCreators.show({title: '下载完成', type: 'success', key: new Date().getTime()});\n        if (arg && arg.info) {\n          console.log('我要发信息我要发信息');\n          const {profile: {name, id}} = ProfileStore.getState();\n        //   var text = prepareTextMessage(':paperclip:\"' + arg.name + '\"接收成功');\n        //   ActorClient.sendTextMessage(arg.info, text);\n            var spapdata = `<v:Envelope xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:d=\"http://www.w3.org/2001/XMLSchema\" xmlns:c=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:v=\"http://schemas.xmlsoap.org/soap/envelope/\">\n                            <v:Header />\n                            <v:Body>\n                                <n0:insertXzrz id=\"o0\" c:root=\"1\" xmlns:n0=\"http://eaglesoft\">\n                                    <json i:type=\"d:string\">{'messageId': '${ arg.info.rid }','userId': '${ id }','userName':'${ name }'}</json>\n                                </n0:insertXzrz>\n                            </v:Body>\n                        </v:Envelope>`;\n            var method = 'selectXzrz';  \n            $.ajax({\n                url: 'http://61.175.100.14:8012/ActorServices-Maven/services/ActorService',\n                type: 'post',\n                data: spapdata,\n                beforeSend(request) {\n                    console.log('beforeSend', request);\n                    request.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8');\n                    request.setRequestHeader('SOAPActrin', 'http://eaglesoft/' + method);\n                },\n                success(res) {\n                }\n            });\n        }\n      });\n      window.messenger.listenOnRender('downloadCancelled', function(event, arg) {\n        MessageAlertActionCreators.show({title: '下载取消', type: 'warning', key: new Date().getTime()});\n      });\n      this.getDialogStore();\n    } else {\n      document.addEventListener('visibilitychange', this.onVisibilityChange);\n\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('visibilitychange', this.onVisibilityChange);\n  }\n\n  handleEletronEr() {\n    window.messenger.listenOnRender('inMainTimes', (event, data) => {\n      console.log('inMainTimes', data, LoginStore.isLoggedIn());\n      if (data.main === 1 && data.login === 0 && LoginStore.isLoggedIn()) {\n        // 直接进入main并处于登录状态，需要退出登录处理\n        LoginActionCreators.setLoggedOut(true);\n      }\n    });\n    ActorClient.sendToElectron('recodeInMain');\n  }\n\n  getDialogStore() {\n    window.messenger.listenOnRender('dialogStore', function(event, arg) {\n      // console.log('dialogStore', arg, );\n      if (arg && arg['dialogs_' + ProfileStore.getProfile().id]) {\n        setTimeout(() => {\n          DialogActionCreators.setDialogs(arg['dialogs_' + ProfileStore.getProfile().id]);\n        }, 1)\n      }\n    });\n    ActorClient.sendToElectron('getDialogStore');\n  }\n\n  handleVisible() {\n    if (document.visibilityState === 'visible') {\n      ActorClient.sendToElectron('window-visible');\n    } else if (document.visibilityState === 'hidden') {\n      ActorClient.sendToElectron('window-hidden');\n    }\n  }\n\n  onVisibilityChange = (isNotTj) => {\n    console.log('onVisibilityChange is-hidden', document.hidden);\n    if (document.hidden) {\n      VisibilityActionCreators.createAppHidden();\n    } else {\n      VisibilityActionCreators.createAppVisible(isNotTj);\n    }\n  };\n\n  renderCall() {\n    const { features } = DelegateContainer.get();\n\n    if (!features.calls) {\n      return null;\n    }\n\n    return <SmallCall />;\n  }\n  handleClick() {\n    MessageAlertActionCreators.show({name: 123, type: 'success', key: new Date().getTime()})\n  }\n\n  render() {\n    console.log('main render========');\n    const { Sidebar, Toolbar } = this.components;\n    return (\n      <div className=\"app\">\n        {/* <a href=\"javascript:;\" target=\"_self\" onClick={this.handleClick.bind(this)} style={{position: 'absolute', 'zIndex': 99999, top: 0, left: 0}}>click</a> */}\n\n        <ConnectionState />\n        <Favicon />\n\n        <Toolbar />\n        <section className=\"wrapper\">\n          <Sidebar />\n          {this.props.children}\n        </section>\n\n        <MessageAlert />\n        <ModalsWrapper />\n        <MenuOverlay />\n\n        {this.renderCall()}\n      </div>\n    );\n  }\n}\n\nexport default Main;\n"]}