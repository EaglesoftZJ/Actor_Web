{"version":3,"sources":["../../src/components/Main.react.js"],"names":["Main","props","onVisibilityChange","document","hidden","createAppHidden","createAppVisible","components","getComponents","get","Sidebar","sidebar","Toolbar","toolbar","componentWillMount","isElectron","handleEletronEr","componentDidMount","window","messenger","listenOnRender","event","arg","push","sendToElectron","key","value","addEventListener","componentWillUnmount","removeEventListener","data","info","isLogin","localStorage","clear","setLoggedIn","redirect","renderCall","features","calls","render","children","propTypes","params","object","oneOfType","arrayOf","node"],"mappings":"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","file":"Main.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\nimport { isFunction } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport DelegateContainer from '../utils/DelegateContainer';\n\nimport VisibilityActionCreators from '../actions/VisibilityActionCreators';\nimport LoginActionCreators from '../actions/LoginActionCreators';\n\nimport DefaultSidebar from './Sidebar.react';\nimport DefaultToolbar from './Toolbar.react';\nimport ConnectionState from './common/ConnectionState.react';\nimport Favicon from './common/Favicon.react';\n\nimport ModalsWrapper from './modals/ModalsWrapper.react';\nimport MenuOverlay from './common/MenuOverlay.react';\nimport SmallCall from './SmallCall.react';\nimport loading from '../utils/DataLoading';\nimport ActorClient from '../utils/ActorClient';\n\nimport history from '../utils/history';\nimport { setTimeout } from 'timers';\n\nclass Main extends Component {\n  static propTypes = {\n    params: PropTypes.object,\n    children: PropTypes.oneOfType([\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ])\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.components = this.getComponents();\n  }\n\n  getComponents() {\n    const { components } = DelegateContainer.get();\n\n    if (components) {\n      return {\n        Sidebar: isFunction(components.sidebar) ? components.sidebar : DefaultSidebar,\n        Toolbar: isFunction(components.toolbar) ? components.toolbar : DefaultToolbar\n      };\n    }\n\n    return {\n      Sidebar: DefaultSidebar,\n      Toolbar: DefaultToolbar\n    };\n  }\n  componentWillMount() {\n    if (ActorClient.isElectron()) {\n      this.handleEletronEr();\n    }\n  }\n\n  componentDidMount() {\n    this.onVisibilityChange();\n    if (ActorClient.isElectron()) {\n      window.messenger.listenOnRender('windows-blur', function(event, arg) {\n        history.push('/im');\n      })\n\n      window.messenger.listenOnRender('windows-focus', function(event, arg) {\n\n        history.push(`/im/${arg}`);\n      })\n\n      window.messenger.listenOnRender('setLoggedOut', function(event, arg) {\n        if (ActorClient.isElectron()) {\n            // 存储用户信息\n          ActorClient.sendToElectron('setLoginStore', {key: 'info.auto', value: false });\n          ActorClient.sendToElectron('setLoginStore', {key: 'info.isLogin', value: false });\n        }\n      })\n    } else {\n      document.addEventListener('visibilitychange', this.onVisibilityChange);\n\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('visibilitychange', this.onVisibilityChange);\n  }\n\n  handleEletronEr() {\n    window.messenger.listenOnRender('loginStore', (event, data) => {\n      if (!data || !data.info.isLogin) {\n        localStorage.clear();\n        history.push('/auth');\n      } else {\n        LoginActionCreators.setLoggedIn({redirect: false})\n      }\n    });\n    ActorClient.sendToElectron('logged-in');\n  }\n\n  onVisibilityChange = () => {\n    if (document.hidden) {\n      VisibilityActionCreators.createAppHidden();\n    } else {\n      VisibilityActionCreators.createAppVisible();\n    }\n  };\n\n  renderCall() {\n    const { features } = DelegateContainer.get();\n\n    if (!features.calls) {\n      return null;\n    }\n\n    return <SmallCall />;\n  }\n\n  render() {\n    const { Sidebar, Toolbar } = this.components;\n\n    return (\n      <div className=\"app\">\n        <ConnectionState />\n        <Favicon />\n\n        <Toolbar />\n        <section className=\"wrapper\">\n          <Sidebar />\n          {this.props.children}\n        </section>\n\n\n        <ModalsWrapper />\n        <MenuOverlay />\n\n        {this.renderCall()}\n      </div>\n    );\n  }\n}\n\nexport default Main;\n"]}