{"version":3,"sources":["../../../src/components/common/VoiceRecorder.react.js"],"names":["isRecordingSupported","VoiceRecorder","props","state","duration","isRecording","onRecordStart","bind","onRecordStop","onStreamReady","onRecordDone","onDurationChange","shouldComponentUpdate","nextProps","nextState","componentDidMount","recorder","addEventListener","componentWillUnmount","removeEventListener","initStream","stop","setState","start","event","onFinish","detail","toFixed","renderDuration","render","className","propTypes","func","isRequired"],"mappings":"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","file":"VoiceRecorder.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classNames from 'classnames';\nimport Recorder from 'opus-recorder';\n\nconst isRecordingSupported = Recorder.isRecordingSupported();\n\nclass VoiceRecorder extends Component {\n  static propTypes = {\n    onFinish: PropTypes.func.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      duration: 0,\n      isRecording: false\n    };\n\n    this.onRecordStart = this.onRecordStart.bind(this);\n    this.onRecordStop = this.onRecordStop.bind(this);\n    this.onStreamReady = this.onStreamReady.bind(this);\n    this.onRecordDone = this.onRecordDone.bind(this);\n    this.onDurationChange = this.onDurationChange.bind(this);\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextState.isRecording !== this.state.isRecording ||\n           nextState.duration !== this.state.duration;\n  }\n\n  componentDidMount() {\n    if (isRecordingSupported) {\n      this.recorder = new Recorder();\n      this.recorder.addEventListener('duration', this.onDurationChange);\n      this.recorder.addEventListener('streamReady', this.onStreamReady);\n      this.recorder.addEventListener('dataAvailable', this.onRecordDone);\n    }\n  }\n\n  componentWillUnmount() {\n    this.recorder.removeEventListener('duration', this.onDurationChange);\n    this.recorder.removeEventListener('streamReady', this.onStreamReady);\n    this.recorder.removeEventListener('dataAvailable', this.onRecordDone);\n    this.recorder = null;\n  }\n\n  onRecordStart() {\n    this.recorder.initStream();\n  }\n\n  onRecordStop() {\n    this.recorder.stop();\n    this.setState({ isRecording: false, duration: 0 });\n  }\n\n  onStreamReady() {\n    this.recorder.start();\n    this.setState({ isRecording: true });\n  }\n\n  onRecordDone(event) {\n    // duration must be in ms\n    const duration = this.state.duration * 1000;\n    if (duration >= 100) {\n      this.props.onFinish(duration, event.detail);\n    }\n  }\n\n  onDurationChange(event) {\n    const duration = event.detail.toFixed(2);\n    this.setState({ duration });\n  }\n\n  renderDuration() {\n    if (!this.state.duration) {\n      return null;\n    }\n\n    return (\n      <div className=\"voice-recorder__duration\">\n        <div className=\"fill row middle-xs center-xs\">\n          Voice message duration:&nbsp; {this.state.duration}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    if (!isRecordingSupported) {\n      return null;\n    }\n\n    const className = classNames('voice-recorder__icon', {\n      'voice-recorder__icon--active': this.state.isRecording\n    });\n\n    return (\n      <div className=\"voice-recorder\">\n        <span className={className} onMouseDown={this.onRecordStart} onMouseUp={this.onRecordStop}>\n          <i className=\"material-icons\">mic</i>\n        </span>\n        {this.renderDuration()}\n      </div>\n    );\n  }\n}\n\nexport default VoiceRecorder;\n"]}