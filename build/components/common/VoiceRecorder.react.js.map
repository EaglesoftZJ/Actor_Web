{"version":3,"sources":["../../../src/components/common/VoiceRecorder.react.js"],"names":["isRecordingSupported","VoiceRecorder","props","state","duration","isRecording","onRecordStart","bind","onRecordStop","onStreamReady","onRecordDone","onDurationChange","shouldComponentUpdate","nextProps","nextState","componentDidMount","recorder","addEventListener","componentWillUnmount","removeEventListener","initStream","stop","setState","start","event","onFinish","detail","toFixed","renderDuration","render","className","propTypes","func","isRequired"],"mappings":"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","file":"VoiceRecorder.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport classNames from 'classnames';\r\nimport Recorder from 'opus-recorder';\r\n\r\nconst isRecordingSupported = Recorder.isRecordingSupported();\r\n\r\nclass VoiceRecorder extends Component {\r\n  static propTypes = {\r\n    onFinish: PropTypes.func.isRequired\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      duration: 0,\r\n      isRecording: false\r\n    };\r\n\r\n    this.onRecordStart = this.onRecordStart.bind(this);\r\n    this.onRecordStop = this.onRecordStop.bind(this);\r\n    this.onStreamReady = this.onStreamReady.bind(this);\r\n    this.onRecordDone = this.onRecordDone.bind(this);\r\n    this.onDurationChange = this.onDurationChange.bind(this);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return nextState.isRecording !== this.state.isRecording ||\r\n           nextState.duration !== this.state.duration;\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (isRecordingSupported) {\r\n      this.recorder = new Recorder();\r\n      this.recorder.addEventListener('duration', this.onDurationChange);\r\n      this.recorder.addEventListener('streamReady', this.onStreamReady);\r\n      this.recorder.addEventListener('dataAvailable', this.onRecordDone);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.recorder.removeEventListener('duration', this.onDurationChange);\r\n    this.recorder.removeEventListener('streamReady', this.onStreamReady);\r\n    this.recorder.removeEventListener('dataAvailable', this.onRecordDone);\r\n    this.recorder = null;\r\n  }\r\n\r\n  onRecordStart() {\r\n    this.recorder.initStream();\r\n  }\r\n\r\n  onRecordStop() {\r\n    this.recorder.stop();\r\n    this.setState({ isRecording: false, duration: 0 });\r\n  }\r\n\r\n  onStreamReady() {\r\n    this.recorder.start();\r\n    this.setState({ isRecording: true });\r\n  }\r\n\r\n  onRecordDone(event) {\r\n    // duration must be in ms\r\n    const duration = this.state.duration * 1000;\r\n    if (duration >= 100) {\r\n      this.props.onFinish(duration, event.detail);\r\n    }\r\n  }\r\n\r\n  onDurationChange(event) {\r\n    const duration = event.detail.toFixed(2);\r\n    this.setState({ duration });\r\n  }\r\n\r\n  renderDuration() {\r\n    if (!this.state.duration) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className=\"voice-recorder__duration\">\r\n        <div className=\"fill row middle-xs center-xs\">\r\n          Voice message duration:&nbsp; {this.state.duration}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!isRecordingSupported) {\r\n      return null;\r\n    }\r\n\r\n    const className = classNames('voice-recorder__icon', {\r\n      'voice-recorder__icon--active': this.state.isRecording\r\n    });\r\n\r\n    return (\r\n      <div className=\"voice-recorder\">\r\n        <span className={className} onMouseDown={this.onRecordStart} onMouseUp={this.onRecordStop}>\r\n          <i className=\"material-icons\">mic</i>\r\n        </span>\r\n        {this.renderDuration()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default VoiceRecorder;\r\n"]}