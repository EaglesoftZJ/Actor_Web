{"version":3,"sources":["../../../src/components/common/popover.react.js"],"names":["Popover","componentDidMount","componentDidUpdate","isShow","props","resetPopoverPosition","componentWillReceiveProps","nextProps","state","left","top","allowTop","node","container","popoverHeight","refs","popover","outerHeight","nodeTop","position","nodeLeft","nodeWidth","outerWidth","nodeHeight","toLeft","toTop","wTop","window","scrollTop","wBottom","height","aTop","newToTop","offset","setState","handleMouseMove","event","nativeEvent","stopImmediatePropagation","renderArrow","style","renderInfo","children","render","popoverClassName","propTypes","object","bool"],"mappings":"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","file":"popover.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes, Children } from 'react';\nimport { FormattedHTMLMessage } from 'react-intl';\nimport $ from 'jquery';\n\nimport classnames from 'classnames';\n\nclass Popover extends Component {\n  static propTypes = {\n    node: PropTypes.object,\n    isShow: PropTypes.bool,\n    container: PropTypes.object,\n  };\n  componentDidMount() {\n  }\n  componentDidUpdate() {\n    const { isShow } = this.props;\n    isShow && this.resetPopoverPosition();\n  }\n  componentWillReceiveProps (nextProps) {\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      left: 0,\n      top: 0,\n      allowTop: 0\n    };\n  }\n\n  resetPopoverPosition() {\n    const { node, container } = this.props;\n    const { left, top, allowTop } = this.state; \n    if (!node) return;\n    // this.setState({'left': 10, 'top': 10});\n    let popoverHeight = $(this.refs.popover).outerHeight();\n    let nodeTop = $(node).position().top;\n    let nodeLeft = $(node).position().left;\n    let nodeWidth = $(node).outerWidth(true);\n    let nodeHeight = $(node).outerHeight(true);\n    let toLeft = nodeLeft + nodeWidth + 10;\n    let toTop = nodeTop + nodeHeight - popoverHeight / 2 - nodeHeight / 2;\n    let wTop = $(window).scrollTop();\n    let wBottom = wTop + $(window).height();\n    let aTop = $(this.refs.popover).outerHeight() / 2 - 10;\n    let newToTop = 0;\n    if (container && $(container).offset().top - wTop + toTop < 0) {\n      newToTop = wTop - $(container).offset().top + 4;\n    } else if (container && (wTop + wBottom) < $(container).offset().top + toTop + popoverHeight) {\n      newToTop = wTop + wBottom - 4 - popoverHeight - $(container).offset().top;\n    }\n    if (newToTop) {\n      aTop = aTop + (toTop - newToTop);\n      toTop = newToTop;\n    }\n    if (left !== toLeft || top !== toTop || aTop !== allowTop) {\n      this.setState({'left': toLeft, 'top': toTop, 'allowTop': aTop});\n    }\n  }\n\n  handleMouseMove(event) {\n    event.nativeEvent.stopImmediatePropagation();\n  }\n\n  renderArrow() {\n    const { allowTop } = this.state;\n    let style = {\n      // top: ($(this.refs.popover).outerHeight() / 2 - 10) + 'px' \n      top: allowTop + 'px'\n    };\n    return (\n      <div className=\"arrow\" style={style}></div>\n    )\n  }\n  renderInfo() {\n    const { children } = this.props;\n    if (!children) {\n      return <FormattedHTMLMessage id=\"modal.quickSearch.notHaveInfo\"/>\n    }\n    return children;\n  }\n\n  render() {\n    const { isShow } = this.props;\n    const { left, top } = this.state;\n    let popoverClassName = classnames('popover-con', {'hide': !isShow});\n   return (\n      <div ref=\"popover\" onMouseMove={this.handleMouseMove} className={popoverClassName} style={{left: left + 'px', top: top + 'px'}}>\n        { this.renderInfo() }\n        { this.renderArrow() }\n      </div>\n    );\n  }\n}\n\nexport default Popover;\n"]}