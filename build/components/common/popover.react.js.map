{"version":3,"sources":["../../../src/components/common/popover.react.js"],"names":["Popover","componentDidMount","componentDidUpdate","isShow","props","resetPopoverPosition","componentWillReceiveProps","nextProps","state","left","top","allowTop","node","container","addLeft","addTop","popoverHeight","refs","popover","outerHeight","nodeTop","position","nodeLeft","nodeWidth","outerWidth","nodeHeight","toLeft","toTop","wTop","window","scrollTop","wBottom","height","aTop","newToTop","offset","setState","handleMouseMove","event","nativeEvent","stopImmediatePropagation","renderArrow","style","renderInfo","children","emptyMsg","msg","render","maxHeight","popoverClassName","propTypes","object","bool","number","string","defaultProps"],"mappings":"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","file":"popover.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes, Children } from 'react';\nimport { FormattedHTMLMessage } from 'react-intl';\nimport $ from 'jquery';\n\nimport classnames from 'classnames';\n\nclass Popover extends Component {\n  static propTypes = {\n    node: PropTypes.object,\n    isShow: PropTypes.bool,\n    container: PropTypes.object,\n    addLeft: PropTypes.number,\n    addTop: PropTypes.number,\n    emptyMsg: PropTypes.string,\n    maxHeight: PropTypes.number,\n  };\n\n  static defaultProps = {\n    addLeft: 0,\n    addTop: 0\n  }\n  componentDidMount() {\n  }\n  componentDidUpdate() {\n    const { isShow } = this.props;\n    isShow && this.resetPopoverPosition();\n  }\n  componentWillReceiveProps (nextProps) {\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      left: 0,\n      top: 0,\n      allowTop: 0\n    };\n  }\n\n  resetPopoverPosition() {\n    const { node, container, addLeft, addTop } = this.props;\n    const { left, top, allowTop } = this.state; \n    if (!node) return;\n    // this.setState({'left': 10, 'top': 10});\n    let popoverHeight = $(this.refs.popover).outerHeight();\n    let nodeTop = $(node).position().top;\n    let nodeLeft = $(node).position().left;\n    let nodeWidth = $(node).outerWidth(true);\n    let nodeHeight = $(node).outerHeight(true);\n    let toLeft = nodeLeft + nodeWidth + 10 + addLeft;\n    let toTop = nodeTop + nodeHeight - popoverHeight / 2 - nodeHeight / 2 + addTop;\n    let wTop = $(window).scrollTop();\n    let wBottom = wTop + $(window).height();\n    let aTop = $(this.refs.popover).outerHeight() / 2 - 10;\n    let newToTop = 0;\n    if (container && $(container).offset().top - wTop + toTop < 0) {\n      newToTop = wTop - $(container).offset().top + 4;\n    } else if (container && (wTop + wBottom) < $(container).offset().top + toTop + popoverHeight) {\n      newToTop = wTop + wBottom - 4 - popoverHeight - $(container).offset().top;\n    }\n    if (newToTop) {\n      aTop = aTop + (toTop - newToTop);\n      toTop = newToTop;\n    }\n    if (left !== toLeft || top !== toTop || aTop !== allowTop) {\n      this.setState({'left': toLeft, 'top': toTop, 'allowTop': aTop});\n    }\n  }\n\n  handleMouseMove(event) {\n    event.nativeEvent.stopImmediatePropagation();\n  }\n\n  renderArrow() {\n    const { allowTop } = this.state;\n    let style = {\n      // top: ($(this.refs.popover).outerHeight() / 2 - 10) + 'px' \n      top: allowTop + 'px'\n    };\n    return (\n      <div className=\"arrow\" style={style}></div>\n    )\n  }\n  renderInfo() {\n    const { children, emptyMsg } = this.props;\n    var msg = emptyMsg;\n    if (!emptyMsg) {\n        msg = 'modal.quickSearch.notHaveInfo';\n    }\n    if (!children) {\n      return <FormattedHTMLMessage id={ msg }/>\n    }\n    return children;\n  }\n\n  render() {\n    const { isShow, maxHeight } = this.props;\n    const { left, top } = this.state;\n    let popoverClassName = classnames('popover-con', {'hide': !isShow});\n   return (\n      <div ref=\"popover\" onMouseMove={this.handleMouseMove} className={popoverClassName} style={{left: left + 'px', top: top + 'px'}}>\n        <div className=\"popover-scroll\" style={{maxHeight}}>\n            { this.renderInfo() }\n            { this.renderArrow() }\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Popover;\n"]}