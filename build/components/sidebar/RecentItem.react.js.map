{"version":3,"sources":["../../../src/components/sidebar/RecentItem.react.js"],"names":["RecentItem","props","handleClick","bind","handleOpenContextMenu","componentDidMount","onUpdate","componentDidUpdate","shouldComponentUpdate","nextProps","dialog","isActive","archiveState","event","preventDefault","peer","contextPos","x","pageX","clientX","y","pageY","clientY","openRecentContextMenu","isElectron","sendToElectron","key","push","renderCounter","counter","renderArchiveState","PENDING","renderOnlineState","render","title","recentItemClassName","avatar","placeholder","__html","propTypes","bool","isRequired","object","number","func","defaultProps"],"mappings":"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","file":"RecentItem.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport { escapeWithEmoji } from '../../utils/EmojiUtils';\nimport history from '../../utils/history';\n\nimport { AsyncActionStates } from '../../constants/ActorAppConstants';\n\nimport DropdownActionCreators from '../../actions/DropdownActionCreators';\nimport ActorClient from '../../utils/ActorClient';\n\nActorClient\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport Stateful from '../common/Stateful.react';\n\nclass RecentItem extends Component {\n  static propTypes = {\n    isActive: PropTypes.bool.isRequired,\n    dialog: PropTypes.object.isRequired,\n    archiveState: PropTypes.number.isRequired,\n    onUpdate: PropTypes.func.isRequired\n  };\n\n  static defaultProps = {\n    isActive: false,\n    archiveState: AsyncActionStates.PENDING\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n    this.handleOpenContextMenu = this.handleOpenContextMenu.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.onUpdate();\n  }\n\n  componentDidUpdate() {\n    this.props.onUpdate();\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return nextProps.dialog !== this.props.dialog ||\n           nextProps.isActive !== this.props.isActive ||\n           nextProps.archiveState !== this.props.archiveState;\n  }\n\n  handleOpenContextMenu(event) {\n    event.preventDefault();\n    const { peer } = this.props.dialog.peer;\n    const contextPos = {\n      x: event.pageX || event.clientX,\n      y: event.pageY || event.clientY\n    };\n    DropdownActionCreators.openRecentContextMenu(contextPos, peer);\n  }\n\n  handleClick() {\n    const { dialog } = this.props;\n    // 对话框切换推送主进程\n    if (ActorClient.isElectron()) {\n      ActorClient.sendToElectron('dialog-switch', dialog.peer.peer.key);\n    }\n    history.push(`/im/${dialog.peer.peer.key}`);\n  }\n\n  renderCounter() {\n    const { dialog } = this.props;\n    if (dialog.counter === 0) {\n      return null;\n    }\n\n    return (\n      <span className=\"recent__item__counter\">{dialog.counter}</span>\n    );\n  }\n\n  renderArchiveState() {\n    const { archiveState } = this.props;\n    if (archiveState === AsyncActionStates.PENDING) {\n      return null;\n    }\n\n    return (\n      <Stateful\n        currentState={archiveState}\n        processing={\n            <div className=\"archive archive--in-progress\">\n              <i className=\"icon material-icons spin\">autorenew</i>\n            </div>\n          }\n        success={\n            <div className=\"archive archive--in-progress\">\n              <i className=\"icon material-icons\">check</i>\n            </div>\n          }\n        failure={\n            <div className=\"archive archive--failure\">\n              <i className=\"icon material-icons\">warning</i>\n            </div>\n          }\n      />\n    );\n  }\n  renderOnlineState() {\n    return (\n      <span className=\"online-state online-state__ofl\"></span>\n    );\n  }\n\n  render() {\n    const { dialog, isActive } = this.props;\n    const title = escapeWithEmoji(dialog.peer.title);\n\n    const recentItemClassName = classnames('recent__item', {\n      'recent__item--active': isActive,\n      'recent__item--unread': dialog.counter !== 0\n    });\n\n    return (\n      <div onContextMenu={this.handleOpenContextMenu} onClick={this.handleClick} className={recentItemClassName}>\n        <AvatarItem\n          className=\"recent__item__avatar\"\n          size=\"tiny\"\n          image={dialog.peer.avatar}\n          placeholder={dialog.peer.placeholder}\n          title={dialog.peer.title}\n        />\n        <div className=\"recent__item__title col-xs\" dangerouslySetInnerHTML={{ __html: title }}/>\n        {this.renderCounter()}\n        {this.renderArchiveState()}\n        { this.renderOnlineState() }\n      </div>\n    );\n  }\n}\n\nexport default RecentItem;\n"]}