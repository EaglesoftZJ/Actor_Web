{"version":3,"sources":["../../../src/components/sidebar/RecentItem.react.js"],"names":["RecentItem","props","handleClick","bind","handleOpenContextMenu","componentDidMount","onUpdate","componentDidUpdate","shouldComponentUpdate","nextProps","dialog","isActive","archiveState","event","preventDefault","peer","contextPos","x","pageX","clientX","y","pageY","clientY","openRecentContextMenu","isElectron","sendToElectron","key","push","renderCounter","counter","renderArchiveState","PENDING","renderOnlineState","render","title","recentItemClassName","avatar","placeholder","__html","propTypes","bool","isRequired","object","number","func","defaultProps"],"mappings":"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","file":"RecentItem.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport classnames from 'classnames';\r\nimport { escapeWithEmoji } from '../../utils/EmojiUtils';\r\nimport history from '../../utils/history';\r\n\r\nimport { AsyncActionStates } from '../../constants/ActorAppConstants';\r\n\r\nimport DropdownActionCreators from '../../actions/DropdownActionCreators';\r\nimport ActorClient from '../../utils/ActorClient';\r\n\r\nActorClient\r\n\r\nimport AvatarItem from '../common/AvatarItem.react';\r\nimport Stateful from '../common/Stateful.react';\r\n\r\nclass RecentItem extends Component {\r\n  static propTypes = {\r\n    isActive: PropTypes.bool.isRequired,\r\n    dialog: PropTypes.object.isRequired,\r\n    archiveState: PropTypes.number.isRequired,\r\n    onUpdate: PropTypes.func.isRequired\r\n  };\r\n\r\n  static defaultProps = {\r\n    isActive: false,\r\n    archiveState: AsyncActionStates.PENDING\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.handleOpenContextMenu = this.handleOpenContextMenu.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.onUpdate();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.props.onUpdate();\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps) {\r\n    return nextProps.dialog !== this.props.dialog ||\r\n           nextProps.isActive !== this.props.isActive ||\r\n           nextProps.archiveState !== this.props.archiveState;\r\n  }\r\n\r\n  handleOpenContextMenu(event) {\r\n    event.preventDefault();\r\n    const { peer } = this.props.dialog.peer;\r\n    const contextPos = {\r\n      x: event.pageX || event.clientX,\r\n      y: event.pageY || event.clientY\r\n    };\r\n    DropdownActionCreators.openRecentContextMenu(contextPos, peer);\r\n  }\r\n\r\n  handleClick() {\r\n    const { dialog } = this.props;\r\n    // 对话框切换推送主进程\r\n    if (ActorClient.isElectron()) {\r\n      ActorClient.sendToElectron('dialog-switch', dialog.peer.peer.key);\r\n    }\r\n    history.push(`/im/${dialog.peer.peer.key}`);\r\n  }\r\n\r\n  renderCounter() {\r\n    const { dialog } = this.props;\r\n    if (dialog.counter === 0) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <span className=\"recent__item__counter\">{dialog.counter}</span>\r\n    );\r\n  }\r\n\r\n  renderArchiveState() {\r\n    const { archiveState } = this.props;\r\n    if (archiveState === AsyncActionStates.PENDING) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Stateful\r\n        currentState={archiveState}\r\n        processing={\r\n            <div className=\"archive archive--in-progress\">\r\n              <i className=\"icon material-icons spin\">autorenew</i>\r\n            </div>\r\n          }\r\n        success={\r\n            <div className=\"archive archive--in-progress\">\r\n              <i className=\"icon material-icons\">check</i>\r\n            </div>\r\n          }\r\n        failure={\r\n            <div className=\"archive archive--failure\">\r\n              <i className=\"icon material-icons\">warning</i>\r\n            </div>\r\n          }\r\n      />\r\n    );\r\n  }\r\n  renderOnlineState() {\r\n    return (\r\n      <span className=\"online-state online-state__ofl\"></span>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { dialog, isActive } = this.props;\r\n    const title = escapeWithEmoji(dialog.peer.title);\r\n\r\n    const recentItemClassName = classnames('recent__item', {\r\n      'recent__item--active': isActive,\r\n      'recent__item--unread': dialog.counter !== 0\r\n    });\r\n\r\n    return (\r\n      <div onContextMenu={this.handleOpenContextMenu} onClick={this.handleClick} className={recentItemClassName}>\r\n        <AvatarItem\r\n          className=\"recent__item__avatar\"\r\n          size=\"tiny\"\r\n          image={dialog.peer.avatar}\r\n          placeholder={dialog.peer.placeholder}\r\n          title={dialog.peer.title}\r\n        />\r\n        <div className=\"recent__item__title col-xs\" dangerouslySetInnerHTML={{ __html: title }}/>\r\n        {this.renderCounter()}\r\n        {this.renderArchiveState()}\r\n        { this.renderOnlineState() }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default RecentItem;\r\n"]}