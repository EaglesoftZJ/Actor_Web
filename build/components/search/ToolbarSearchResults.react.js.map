{"version":3,"sources":["../../../src/components/search/ToolbarSearchResults.react.js"],"names":["ToolbarSearchResults","props","state","isShow","node","department","getState","selectedUserId","componentDidMount","setListeners","componentWillUnmount","cleanListeners","renderInfo","yh_data","info","from","where","toArray","renderResults","query","results","length","map","item","index","peerInfo","peer","key","id","title","avatar","type","placeholder","listeners","listen","document","popoverHide","bind","refs","forEach","listener","remove","setState","render","outer","propTypes","string","isRequired","array"],"mappings":";;;;AAIA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;+eAZA;;;;IAcMA,oB;;;AAMJ,gCAAYC,KAAZ,EAAmB;AAAA;;AAAA,iDACjB,sBAAMA,KAAN,CADiB;;AAEjB,UAAKC,KAAL,GAAa;AACXC,cAAQ,KADG;AAEXC,YAAM,IAFK;AAGXC,kBAAY,0BAAgBC,QAAhB,EAHD;AAIXC,sBAAgB,CAAC;AAJN,KAAb;AAFiB;AAQlB;;iCAEDC,iB,gCAAoB;AAClB,SAAKC,YAAL;AACD,G;;iCAEDC,oB,mCAAuB;AACrB,SAAKC,cAAL;AACD,G;;iCAEDC,U,yBAAa;AAAA,iBAC4B,KAAKV,KADjC;AAAA,QACHG,UADG,UACHA,UADG;AAAA,QACSE,cADT,UACSA,cADT;AAAA,QAEHM,OAFG,GAESR,UAFT,CAEHQ,OAFG;;AAGX,QAAIC,OAAO,eAAKC,IAAL,CAAUF,OAAV,EAAmBG,KAAnB,CAAyB,4BAA4BT,cAArD,EAAqEU,OAArE,GAA+E,CAA/E,CAAX;AACA,QAAI,CAACH,IAAL,EAAW,OAAO,IAAP;AACX,WACE,0DAAgB,UAAUA,IAA1B,GADF;AAGD,G;;iCAEDI,a,4BAAgB;AAAA;;AAAA,iBACa,KAAKjB,KADlB;AAAA,QACNkB,KADM,UACNA,KADM;AAAA,QACCC,OADD,UACCA,OADD;;;AAGd,QAAI,CAACA,QAAQC,MAAb,EAAqB;AACnB,aACE;AAAA;AAAA,UAAK,WAAU,WAAf;AACE,yEAAsB,IAAG,iBAAzB,EAA2C,QAAQ,EAAEF,YAAF,EAAnD;AADF,OADF;AAKD;;AAED,WAAOC,QAAQE,GAAR,CAAY,UAACC,IAAD,EAAOC,KAAP,EAAiB;AAClC,aACE;AAAA;AAAA,UAAgB,OAAOA,KAAvB,EAA8B,KAAKD,KAAKE,QAAL,CAAcC,IAAd,CAAmBC,GAAtD;AACE;AACE,eAAKJ,KAAKE,QAAL,CAAcC,IAAd,CAAmBE,EAD1B;AAEE,gBAAML,KAAKE,QAAL,CAAcI,KAFtB;AAGE,kBAAQN,KAAKE,QAAL,CAAcK,MAHxB;AAIE,gBAAMP,KAAKE,QAAL,CAAcC,IAAd,CAAmBK,IAJ3B;AAKE,uBAAaR,KAAKE,QAAL,CAAcO,WAL7B;AAME,0BANF;AAOE;AAPF;AADF,OADF;AAaD,KAdM,CAAP;AAeD,G;;iCACDvB,Y,2BAAe;AACb,SAAKE,cAAL;AACA,SAAKsB,SAAL,GAAiB;AACf;AACA,4BAAcC,MAAd,CAAqBC,QAArB,EAA+B,WAA/B,EAA4C,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAA5C,CAFe,EAGf,wBAAcH,MAAd,CAAqB,KAAKI,IAAL,CAAUlB,OAA/B,EAAwC,QAAxC,EAAkD,KAAKgB,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAlD,CAHe,CAAjB;AAKD,G;;iCAED1B,c,6BAAiB;AACf,QAAI,KAAKsB,SAAT,EAAoB;AAClB,WAAKA,SAAL,CAAeM,OAAf,CAAuB,UAACC,QAAD;AAAA,eAAcA,SAASC,MAAT,EAAd;AAAA,OAAvB;AACA,WAAKR,SAAL,GAAiB,IAAjB;AACD;AACF,G;;iCAEDG,W,0BAAc;AAAA,QACJjC,MADI,GACO,KAAKD,KADZ,CACJC,MADI;;AAEZ,QAAIA,MAAJ,EAAY;AACV,WAAKuC,QAAL,CAAc,EAAC,UAAU,KAAX,EAAd;AACA,WAAK/B,cAAL;AACD;AACF,G;;iCAEDgC,M,qBAAS;AAAA,kBACkB,KAAKzC,KADvB;AAAA,QACCC,MADD,WACCA,MADD;AAAA,QACSC,IADT,WACSA,IADT;;AAEP,WACE;AAAA;AAAA,QAAK,WAAU,eAAf,EAA+B,KAAI,OAAnC;AACI;AAAA;AAAA,UAAS,MAAMA,IAAf,EAAqB,QAAQD,MAA7B,EAAqC,WAAW,KAAKmC,IAAL,CAAUM,KAA1D;AACI,aAAKhC,UAAL;AADJ,OADJ;AAIE;AAAA;AAAA,UAAK,WAAU,0BAAf,EAA0C,KAAI,SAA9C;AACG,aAAKM,aAAL;AADH;AAJF,KADF;AAUD,G;;;;;AAjGGlB,oB,CACG6C,S,GAAY;AACjB1B,SAAO,iBAAU2B,MAAV,CAAiBC,UADP;AAEjB3B,WAAS,iBAAU4B,KAAV,CAAgBD;AAFR,C;kBAmGN/C,oB","file":"ToolbarSearchResults.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { FormattedHTMLMessage } from 'react-intl';\nimport ContactItem from '../common/ContactItem.react';\nimport Popover from '../common/Popover.react';\nimport SelectListItem from '../common/SelectListItem.react';\nimport ContactDetails from '../common/ContactDetails.react';\nimport EventListener from 'fbjs/lib/EventListener';\nimport DepartmentStore from '../../stores/DepartmentStore';\nimport linq from 'Linq';\n\nclass ToolbarSearchResults extends Component {\n  static propTypes = {\n    query: PropTypes.string.isRequired,\n    results: PropTypes.array.isRequired\n  };\n  \n  constructor(props) {\n    super(props);\n    this.state = {\n      isShow: false,\n      node: null,\n      department: DepartmentStore.getState(),\n      selectedUserId: -1\n    }\n  }\n\n  componentDidMount() {\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  renderInfo() {\n    const { department, selectedUserId } = this.state;\n    const { yh_data } = department;\n    let info = linq.from(yh_data).where('parseFloat($.IGIMID) ==' + selectedUserId).toArray()[0];\n    if (!info) return null;\n    return (\n      <ContactDetails peerInfo={info}></ContactDetails>\n    )\n  }\n\n  renderResults() {\n    const { query, results } = this.props;\n\n    if (!results.length) {\n      return (\n        <div className=\"not-found\">\n          <FormattedHTMLMessage id=\"search.notFound\" values={{ query }} />\n        </div>\n      );\n    }\n\n    return results.map((item, index) => {\n      return (\n        <SelectListItem index={index} key={item.peerInfo.peer.key}>\n          <ContactItem\n            uid={item.peerInfo.peer.id}\n            name={item.peerInfo.title}\n            avatar={item.peerInfo.avatar}\n            type={item.peerInfo.peer.type}\n            placeholder={item.peerInfo.placeholder}\n            showDetial\n            instance={this}\n          />\n        </SelectListItem>\n      )\n    });\n  }\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      // EventListener.listen(document, 'keydown', this.handleKeyDown),\n      EventListener.listen(document, 'mousemove', this.popoverHide.bind(this)),\n      EventListener.listen(this.refs.results, 'scroll', this.popoverHide.bind(this))\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => listener.remove());\n      this.listeners = null;\n    }\n  }\n\n  popoverHide() {\n    const { isShow } = this.state;\n    if (isShow) {\n      this.setState({'isShow': false});\n      this.cleanListeners();\n    } \n  }\n\n  render() {\n    const { isShow, node } = this.state;\n    return (\n      <div className=\"popover-outer\" ref=\"outer\">\n          <Popover node={node} isShow={isShow} container={this.refs.outer}>\n            { this.renderInfo() }\n          </Popover>\n        <div className=\"toolbar__search__results\" ref=\"results\">\n          {this.renderResults()}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default ToolbarSearchResults;\n"]}