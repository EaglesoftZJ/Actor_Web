{"version":3,"sources":["../../src/components/SmallCall.react.js"],"names":["SmallCall","getStores","calculatePeerInfo","peer","type","USER","getUser","id","GROUP","getGroup","calculateState","call","getState","isOpen","dialogPeer","getCurrentPeer","isSameDialog","equals","isFloating","peerInfo","props","onAnswer","bind","onEnd","onMuteToggle","onClose","onFullscreen","onUserAdd","onVideo","shouldComponentUpdate","answerCall","state","endCall","toggleCallMute","hide","console","debug","render","isOutgoing","isMuted","create"],"mappings":"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","file":"SmallCall.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component } from 'react';\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\nimport { Container } from 'flux/utils';\n\nimport { PeerTypes } from '../constants/ActorAppConstants';\nimport PeerUtils from '../utils/PeerUtils';\n\nimport CallActionCreators from '../actions/CallActionCreators';\n\nimport CallStore from '../stores/CallStore';\nimport DialogStore from '../stores/DialogStore';\nimport UserStore from '../stores/UserStore';\nimport GroupStore from '../stores/GroupStore';\n\nimport CallDraggable from './call/CallDraggable.react';\n\nclass SmallCall extends Component {\n  static getStores() {\n    return [CallStore, DialogStore];\n  }\n\n  static calculatePeerInfo(peer) {\n    if (peer) {\n      if (peer.type === PeerTypes.USER) {\n        return UserStore.getUser(peer.id);\n      }\n\n      if (peer.type === PeerTypes.GROUP) {\n        return GroupStore.getGroup(peer.id);\n      }\n    }\n\n    return null;\n  }\n\n  static calculateState() {\n    const call = CallStore.getState();\n    if (!call.isOpen) {\n      return { isOpen: false };\n    }\n\n    const dialogPeer = DialogStore.getCurrentPeer();\n    const isSameDialog = PeerUtils.equals(dialogPeer, call.peer);\n\n    if (isSameDialog && !call.isFloating) {\n      return { isOpen: false };\n    }\n\n    return {\n      call,\n      isOpen: true,\n      peerInfo: SmallCall.calculatePeerInfo(call.peer)\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.onAnswer = this.onAnswer.bind(this);\n    this.onEnd = this.onEnd.bind(this);\n    this.onMuteToggle = this.onMuteToggle.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.onFullscreen = this.onFullscreen.bind(this);\n    this.onUserAdd = this.onUserAdd.bind(this);\n    this.onVideo = this.onVideo.bind(this);\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\n  }\n\n  onAnswer() {\n    CallActionCreators.answerCall(this.state.call.id);\n  }\n\n  onEnd() {\n    CallActionCreators.endCall(this.state.call.id);\n  }\n\n  onMuteToggle() {\n    CallActionCreators.toggleCallMute(this.state.call.id);\n  }\n\n  onClose() {\n    CallActionCreators.hide();\n  }\n\n  onFullscreen() {\n    console.debug('onFullscreen');\n  }\n\n  onUserAdd() {\n    console.debug('onUserAdd');\n  }\n\n  onVideo() {\n    console.debug('onVideo');\n  }\n\n  render() {\n    const { isOpen, call, peerInfo } = this.state;\n\n    if (!isOpen) {\n      return null;\n    }\n\n    return (\n      <CallDraggable\n        peerInfo={peerInfo}\n        callState={call.state}\n        isOutgoing={call.isOutgoing}\n        isMuted={call.isMuted}\n        onEnd={this.onEnd}\n        onAnswer={this.onAnswer}\n        onMuteToggle={this.onMuteToggle}\n        onFullscreen={this.onFullscreen}\n        onUserAdd={this.onUserAdd}\n        onVideo={this.onVideo}\n        onClose={this.onClose}\n      />\n    );\n  }\n}\n\nexport default Container.create(SmallCall);\n"]}