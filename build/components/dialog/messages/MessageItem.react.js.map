{"version":3,"sources":["../../../../src/components/dialog/messages/MessageItem.react.js"],"names":["MessageItem","getStores","calculateState","prevState","props","isHighlighted","message","isMessageDropdownOpen","rid","context","showActions","event","openMessageActions","target","getBoundingClientRect","toggleMessageSelection","onSelect","onClick","bind","shouldComponentUpdate","nextProps","isShort","peer","equals","sender","show","selectDialogPeerUser","id","renderTitle","isGroupBot","group","getGroup","__html","name","title","renderHeader","state","userName","date","renderLeftBlock","avatar","placeholder","renderActions","isExperimental","messageActionsMenuClassName","render","isSelected","isEditing","messageClassName","content","contextTypes","delegate","object","bool","propTypes","isRequired","string","func","defaultProps","create","withProps"],"mappings":"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","file":"MessageItem.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { noop } from 'lodash';\nimport React, { Component, PropTypes } from 'react';\nimport { Container } from 'flux/utils';\nimport classnames from 'classnames';\nimport { escapeWithEmoji } from '../../../utils/EmojiUtils';\nimport PeerUtils from '../../../utils/PeerUtils';\n\nimport DialogActionCreators from '../../../actions/DialogActionCreators';\nimport ActivityActionCreators from '../../../actions/ActivityActionCreators';\nimport DropdownActionCreators from '../../../actions/DropdownActionCreators';\n\nimport DropdownStore from '../../../stores/DropdownStore';\nimport GroupStore from '../../../stores/GroupStore';\n\nimport SvgIcon from '../../common/SvgIcon.react';\nimport AvatarItem from '../../common/AvatarItem.react';\nimport State from './State.react';\nimport Reactions from './Reactions.react';\nimport MessageContent from './MessageContent.react';\n\nclass MessageItem extends Component {\n  static contextTypes = {\n    delegate: PropTypes.object,\n    isExperimental: PropTypes.bool\n  }\n\n  static propTypes = {\n    peer: PropTypes.object.isRequired,\n    message: PropTypes.object.isRequired,\n    state: PropTypes.string.isRequired,\n    isShort: PropTypes.bool.isRequired,\n    isEditing: PropTypes.bool.isRequired,\n    isSelected: PropTypes.bool.isRequired,\n    onSelect: PropTypes.func.isRequired\n  }\n\n  static defaultProps = {\n    isSelected: false,\n    onSelect: noop\n  };\n\n  static getStores() {\n    return [DropdownStore];\n  }\n\n  static calculateState(prevState, props) {\n    return {\n      isHighlighted: props && props.message ? DropdownStore.isMessageDropdownOpen(props.message.rid) : false\n    }\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.onClick = this.onClick.bind(this);\n  }\n\n  shouldComponentUpdate(nextProps) {\n    return this.props.message !== nextProps.message ||\n           this.props.isShort !== nextProps.isShort;\n  }\n\n  onClick() {\n    const { message, peer } = this.props;\n\n    if (PeerUtils.equals(peer, message.sender.peer)) {\n      ActivityActionCreators.show();\n    } else {\n      DialogActionCreators.selectDialogPeerUser(message.sender.peer.id);\n    }\n  }\n\n  showActions = (event) => {\n    const { message } = this.props;\n    DropdownActionCreators.openMessageActions(event.target.getBoundingClientRect(), message);\n  };\n\n  toggleMessageSelection = () => {\n    const { message, onSelect } = this.props;\n    onSelect(message.rid);\n  };\n\n  renderTitle() {\n    const { message, peer } = this.props;\n\n    if (PeerUtils.isGroupBot(message.sender)) {\n      const group = GroupStore.getGroup(peer.id);\n      return (\n        <span className=\"message__sender__name\" dangerouslySetInnerHTML={{ __html: escapeWithEmoji(group.name) }}/>\n      );\n    } else {\n      return (\n        <span className=\"message__sender__name\" dangerouslySetInnerHTML={{ __html: escapeWithEmoji(message.sender.title) }}/>\n      );\n    }\n  }\n\n  renderHeader() {\n    const { isShort, message, state } = this.props;\n\n    if (isShort) {\n      return null;\n    }\n\n    return (\n      <header className=\"message__header\">\n        <h3 className=\"message__sender\">\n          <a onClick={this.onClick}>\n            {this.renderTitle()}\n            {\n              message.sender.userName\n                ? <span className=\"message__sender__nick\">@{message.sender.userName}</span>\n                : null\n            }\n          </a>\n        </h3>\n        <time className=\"message__timestamp\">{message.date}</time>\n        <State state={state} />\n      </header>\n    );\n  }\n\n  renderLeftBlock() {\n    const { isShort, message, state, peer } = this.props\n\n    if (isShort) {\n      return (\n        <div className=\"message__info\">\n          <time className=\"message__timestamp\">{message.date}</time>\n          <State state={state} />\n        </div>\n      );\n    } else {\n      if (PeerUtils.isGroupBot(message.sender)) {\n        const group = GroupStore.getGroup(peer.id);\n        return (\n          <div className=\"message__info message__info--avatar\">\n            <AvatarItem\n              className=\"message__avatar\"\n              image={group.avatar}\n              placeholder={group.placeholder}\n              title={group.name}\n              onClick={this.onClick}\n            />\n          </div>\n        )\n      } else {\n        return (\n          <div className=\"message__info message__info--avatar\">\n            <AvatarItem\n              className=\"message__avatar\"\n              image={message.sender.avatar}\n              placeholder={message.sender.placeholder}\n              title={message.sender.title}\n              onClick={this.onClick}\n            />\n          </div>\n        )\n      }\n    }\n  }\n\n  renderActions() {\n    const { peer, message } = this.props;\n    const { isHighlighted } = this.state;\n    const { isExperimental } = this.context;\n\n    const messageActionsMenuClassName = classnames('message__actions__menu', {\n      'message__actions__menu--opened': isHighlighted\n    });\n\n    return (\n      <div className=\"message__actions\">\n        <Reactions peer={peer} message={message}/>\n\n        <div className={messageActionsMenuClassName} onClick={this.showActions}>\n          <SvgIcon className=\"icon icon--dropdown\" glyph=\"cog\" />\n        </div>\n\n        {\n          isExperimental\n            ? <div className=\"message__actions__selector\" onClick={this.toggleMessageSelection}>\n                <i className=\"icon material-icons icon-check\"></i>\n              </div>\n            : null\n        }\n      </div>\n    );\n  }\n\n  render() {\n    const { message, isShort, isSelected, isEditing } = this.props;\n    const { isHighlighted } = this.state;\n\n    const messageClassName = classnames('message', {\n      'message--short': isShort,\n      'message--active': isHighlighted,\n      'message--selected': isSelected,\n      'message--editing': isEditing\n    });\n\n    return (\n      <div className={messageClassName}>\n        {this.renderLeftBlock()}\n        <div className=\"message__body\">\n          {this.renderHeader()}\n          <MessageContent content={message.content} />\n        </div>\n        {this.renderActions()}\n      </div>\n    );\n  }\n}\n\nexport default Container.create(MessageItem, { withProps: true });\n"]}