{"version":3,"sources":["../../../../src/components/dialog/messages/Document.react.js"],"names":["Document","props","context","state","peer","getCurrentPeer","renderIcon","fileUrl","isUploading","renderPrview","checkOfficeFile","handlePreviewClick","bind","renderActions","decodeURIComponent","handleDownloadClick","handleMouseMove","handleOpenRecord","padding","height","marginTop","marginLeft","color","fontSize","autoOpen","message","isElectron","window","messenger","sendToElectron","rid","fileName","type","arr","split","arr1","name","encodeURIComponent","slice","filePath","url","open","event","showDocumentRecord","nativeEvent","stopImmediatePropagation","test","RegExp","$1","render","fileSize","fileExtension","className","documentClassName","propTypes","string","isRequired","bool","sortKey","container","object","contextTypes","func"],"mappings":";;;;;;AAIA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;;;;;+eATA;;;;AAYA;;;IAGMA,Q;;;AAkBJ,oBAAYC,KAAZ,EAAmBC,OAAnB,EAA4B;AAAA;;AAAA,iDAC1B,sBAAMD,KAAN,EAAaC,OAAb,CAD0B;;AAE1B,UAAKC,KAAL,GAAa;AACXC,YAAM,sBAAYC,cAAZ;AADK,KAAb;AAF0B;AAK3B;;qBAEDC,U,yBAAa;AAAA,iBACsB,KAAKL,KAD3B;AAAA,QACHM,OADG,UACHA,OADG;AAAA,QACMC,WADN,UACMA,WADN;;;AAGX,QAAIA,WAAJ,EAAiB;AACf,aACE;AAAA;AAAA,UAAK,WAAU,gBAAf;AACE;AAAA;AAAA,YAAG,WAAU,gBAAb;AAAA;AAAA;AADF,OADF;AAKD,KAND,MAMO;AACL,aACE;AAAA;AAAA,UAAG,WAAU,gBAAb,EAA8B,MAAMD,OAApC;AACE;AAAA;AAAA,YAAG,WAAU,gBAAb;AAAA;AAAA;AADF,OADF;AAKD;AACF,G;;qBAEDE,Y,2BAAe;AACb;AACA,QAAI,CAAC,KAAKC,eAAL,EAAL,EAA6B;AAC3B,aAAO,IAAP;AACD;AACD,WAAQ;AAAA;AAAA,QAAG,MAAK,cAAR,EAAuB,SAAS,KAAKC,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAAhC;AAAoE,mEAAkB,IAAG,iBAArB;AAApE,KAAR;AACD,G;;qBAEDC,a,4BAAgB;AAAA,kBACmB,KAAKZ,KADxB;AAAA,QACNM,OADM,WACNA,OADM;AAAA,QACGC,WADH,WACGA,WADH;;;AAGd,QAAIA,WAAJ,EAAiB;AACf,aACE;AAAA;AAAA;AAAM,qEAAkB,IAAG,mBAArB;AAAN,OADF;AAGD,KAJD,MAIO;AACLM;AACA,aACE;AAAA;AAAA,UAAK,WAAU,WAAf;AACM,aAAKL,YAAL,EADN;AAEI;AAAA;AAAA,YAAG,MAAMF,OAAT,EAAkB,SAAS,KAAKQ,mBAAL,CAAyBH,IAAzB,CAA8B,IAA9B,EAAoC,KAApC,CAA3B;AAAuE,uEAAkB,IAAG,kBAArB;AAAvE,SAFJ;AAGI;AAAA;AAAA,YAAG,MAAML,OAAT,EAAkB,SAAS,KAAKQ,mBAAL,CAAyBH,IAAzB,CAA8B,IAA9B,EAAoC,IAApC,CAA3B;AAAsE,uEAAkB,IAAG,yBAArB;AAAtE,SAHJ;AAII;AAAA;AAAA;AACI,uBAAU,KADd;AAEI,6BAAiB,IAFrB;AAGI,6BAAiB,CAHrB;AAII,qBAAS,6DAAkB,IAAG,wBAArB,GAJb;AAKI;AAAA;AAAA,cAAQ,aAAa,KAAKI,eAA1B,EAA2C,SAAS,KAAKC,gBAAL,CAAsBL,IAAtB,CAA2B,IAA3B,CAApD,EAAsF,WAAU,qBAAhG,EAAsH,OAAO,EAACM,SAAS,CAAV,EAAaC,QAAQ,EAArB,EAAyBC,WAAW,CAAC,CAArC,EAAwCC,YAAY,CAApD,EAAuDC,OAAO,SAA9D,EAA7H;AAAuM;AAAA;AAAA,gBAAG,OAAO,EAACC,UAAU,EAAX,EAAV,EAA0B,WAAU,gBAApC;AAAA;AAAA;AAAvM;AALJ;AAJJ,OADF;AAeD;AACF,G;;qBAGDR,mB,gCAAoBS,Q,EAAU;AAAA,QACpBpB,IADoB,GACX,KAAKD,KADM,CACpBC,IADoB;AAAA,QAEpBqB,OAFoB,GAER,KAAKvB,OAFG,CAEpBuB,OAFoB;;AAG5B,QAAI,sBAAYC,UAAZ,EAAJ,EAA8B;AAC5BC,aAAOC,SAAP,CAAiBC,cAAjB,CAAgC,oBAAhC,aAAuDC,KAAKL,QAAQK,GAApE,EAAyEN,kBAAzE,IAAsFpB,IAAtF;AACD;AACF,G;;qBAEDO,kB,iCAAqB;AAAA,kBACW,KAAKV,KADhB;AAAA,QACXM,OADW,WACXA,OADW;AAAA,QACFwB,QADE,WACFA,QADE;;AAEnB,QAAIC,OAAO,KAAKtB,eAAL,EAAX;AACA,QAAIsB,IAAJ,EAAU;AACR,UAAIC,MAAM1B,QAAQ2B,KAAR,CAAc,GAAd,CAAV;AACA,UAAIC,OAAOF,IAAI,CAAJ,EAAOC,KAAP,CAAa,GAAb,CAAX;AACA,UAAIE,OAAOC,mBAAmBA,mBAAmBF,KAAKG,KAAL,CAAW,CAAC,CAAZ,EAAe,CAAf,CAAnB,CAAnB,CAAX;AACA,UAAIC,WAAW,EAAf;AACA,cAAQP,IAAR;AACE,aAAK,KAAL;AACA,aAAK,MAAL;AACEO,qBAAW,2BAAX;AACA;AACF,aAAK,KAAL;AACA,aAAK,MAAL;AACEA,qBAAW,oCAAX;AACA;AACF,aAAK,KAAL;AACA,aAAK,MAAL;AACEA,qBAAW,0BAAX;AACA;AACF,aAAK,KAAL;AACEA,qBAAW,qCAAX;AACA;AAfJ;AAiBA,UAAIC,gCAA8BD,QAA9B,uEAAwGJ,KAAKG,KAAL,CAAW,CAAC,CAAZ,EAAe,CAAC,CAAhB,EAAmB,CAAnB,CAAxG,SAAiIF,IAArI;AACA,4BAAYV,UAAZ,KAA4B,sBAAYG,cAAZ,CAA2B,UAA3B,EAAuC,EAACW,QAAD,EAAvC,CAA5B,GAA4Eb,OAAOc,IAAP,CAAYD,GAAZ,CAA5E;AACD;AACF,G;;qBAEDvB,gB,6BAAiByB,K,EAAO;AAAA,QACdC,kBADc,GACS,KAAKzC,OADd,CACdyC,kBADc;;AAEtBA;AACAD,UAAME,WAAN,CAAkBC,wBAAlB;AACD,G;;qBAED7B,e,4BAAgB0B,K,EAAO;AACrBA,UAAME,WAAN,CAAkBC,wBAAlB;AACD,G;;qBAEDnC,e,8BAAkB;AAAA,QACRqB,QADQ,GACK,KAAK9B,KADV,CACR8B,QADQ;;AAEhB,QAAI,sCAAsCe,IAAtC,CAA2Cf,QAA3C,CAAJ,EAA0D;AACxD,aAAOgB,OAAOC,EAAd;AACD;AACD,WAAO,KAAP;AACD,G;;qBAEDC,M,qBAAS;AAAA,kBACkD,KAAKhD,KADvD;AAAA,QACC8B,QADD,WACCA,QADD;AAAA,QACWmB,QADX,WACWA,QADX;AAAA,QACqBC,aADrB,WACqBA,aADrB;AAAA,QACoCC,SADpC,WACoCA,SADpC;;;AAGP,QAAMC,oBAAoB,0BAAWD,SAAX,EAAsB,KAAtB,CAA1B;;AAEA,WACE;AAAA;AAAA,QAAK,WAAWC,iBAAhB,EAAmC,SAAnC;AACE;AAAA;AAAA,UAAK,WAAU,cAAf;AACG,aAAK/C,UAAL,EADH;AAEE;AAAA;AAAA,YAAK,WAAU,QAAf;AACE;AAAA;AAAA,cAAM,WAAU,oBAAhB;AAAsCyB;AAAtC,WADF;AAEE;AAAA;AAAA,cAAK,WAAU,gBAAf;AACE;AAAA;AAAA,gBAAM,WAAU,sBAAhB;AAAwCmB;AAAxC,aADF;AAEE;AAAA;AAAA,gBAAM,WAAU,qBAAhB;AAAuCC;AAAvC;AAFF,WAFF;AAME;AAAA;AAAA,cAAK,WAAU,mBAAf;AACG,iBAAKtC,aAAL;AADH;AANF;AAFF,OADF;AAcE,6CAAK,WAAU,QAAf;AAdF,KADF;AAkBD,G;;;;;AA9JGb,Q,CACGsD,S,GAAY;AACjB/C,WAAS,iBAAUgD,MADF;AAEjBxB,YAAU,iBAAUwB,MAAV,CAAiBC,UAFV;AAGjBN,YAAU,iBAAUK,MAAV,CAAiBC,UAHV;AAIjBL,iBAAe,iBAAUI,MAAV,CAAiBC,UAJf;AAKjBhD,eAAa,iBAAUiD,IAAV,CAAeD,UALX;AAMjBJ,aAAW,iBAAUG,MANJ;AAOjBG,WAAS,iBAAUH,MAPF;AAQjBI,aAAW,iBAAUC;AARJ,C;AADf5D,Q,CAYG6D,Y,GAAe;AACpBlB,sBAAoB,iBAAUmB,IADV;AAEpBrC,WAAS,iBAAUmC;AAFC,C;kBAqJT5D,Q","file":"Document.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport { FormattedMessage } from 'react-intl';\nimport Tooltip from 'rc-tooltip';\nimport DialogStore from '../../../stores/DialogStore';\nimport ActorClient from '../../../utils/ActorClient';\n\n\n/**\n * Class that represents a component for display document message content\n */\nclass Document extends Component {\n  static propTypes = {\n    fileUrl: PropTypes.string,\n    fileName: PropTypes.string.isRequired,\n    fileSize: PropTypes.string.isRequired,\n    fileExtension: PropTypes.string.isRequired,\n    isUploading: PropTypes.bool.isRequired,\n    className: PropTypes.string,\n    sortKey: PropTypes.string,\n    container: PropTypes.object,\n  }\n  \n  static contextTypes = {\n    showDocumentRecord: PropTypes.func,\n    message: PropTypes.object\n  }\n  \n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      peer: DialogStore.getCurrentPeer()\n    };\n  }\n\n  renderIcon() {\n    const { fileUrl, isUploading } = this.props;\n\n    if (isUploading) {\n      return (\n        <div className=\"document__icon\">\n          <i className=\"material-icons\">attach_file</i>\n        </div>\n      );\n    } else {\n      return (\n        <a className=\"document__icon\" href={fileUrl}>\n          <i className=\"material-icons\">attach_file</i>\n        </a>\n      );\n    }\n  }\n\n  renderPrview() {\n    // 渲染预览按钮\n    if (!this.checkOfficeFile()) {\n      return null;\n    }\n    return (<a href=\"javascript:;\" onClick={this.handlePreviewClick.bind(this)}><FormattedMessage id=\"message.preview\"/></a>);\n  }\n\n  renderActions() {\n    const { fileUrl, isUploading } = this.props;\n\n    if (isUploading) {\n      return (\n        <span><FormattedMessage id=\"message.uploading\"/></span>\n      );\n    } else {\n      decodeURIComponent\n      return (\n        <div className=\"btn-group\">\n            { this.renderPrview() }\n            <a href={fileUrl} onClick={this.handleDownloadClick.bind(this, false)}><FormattedMessage id=\"message.download\"/></a>\n            <a href={fileUrl} onClick={this.handleDownloadClick.bind(this, true)}><FormattedMessage id=\"message.downloadAndOpen\"/></a>\n            <Tooltip\n                placement=\"top\"\n                mouseEnterDelay={0.15}\n                mouseLeaveDelay={0}\n                overlay={<FormattedMessage id=\"tooltip.documentRecord\"/>}>\n                <button onMouseMove={this.handleMouseMove} onClick={this.handleOpenRecord.bind(this)} className=\"button button--icon\" style={{padding: 0, height: 24, marginTop: -2, marginLeft: 5, color: '#468ee5'}}><i style={{fontSize: 20}} className=\"material-icons\">history</i></button>\n            </Tooltip>\n            {/* <a href={fileUrl} style={{'paddingLeft': 5}} onMouseMove={this.handleMouseMove} onMouseEnter={this.handleOpenRecord.bind(this)}><FormattedMessage id=\"message.downloadDetial\"/></a> */}\n        </div>\n      );\n    }\n  }\n  \n  \n  handleDownloadClick(autoOpen) {\n    const { peer } = this.state;\n    const { message } = this.context;\n    if (ActorClient.isElectron()) {\n      window.messenger.sendToElectron('will-download-info', {rid: message.rid, autoOpen, ...peer});\n    }\n  }\n\n  handlePreviewClick() {\n    const { fileUrl, fileName } = this.props;\n    var type = this.checkOfficeFile();\n    if (type) {\n      var arr = fileUrl.split('?');\n      var arr1 = arr[0].split('/');\n      var name = encodeURIComponent(encodeURIComponent(arr1.slice(-1)[0]));\n      var filePath = '';\n      switch (type) {\n        case 'doc':\n        case 'docx':\n          filePath = '/wv/wordviewerframe.aspx?';\n          break;\n        case 'xls':\n        case 'xlsx':\n          filePath = '/x/_layouts/xlviewerinternal.aspx?';\n          break;\n        case 'ppt':\n        case 'pptx':\n          filePath = '/p/PowerPointFrame.aspx?';\n          break;\n        case 'pdf':\n          filePath = '/wv/wordviewerframe.aspx?PdfMode=1&';\n          break;\n      }\n      var url = `http://220.189.207.21${filePath}WOPISrc=http://61.175.100.14:8090/FlyChatWebService/wopi/files/${arr1.slice(-2, -1)[0]}/${name}`;\n      ActorClient.isElectron() ?  ActorClient.sendToElectron('openLink', {url}) : window.open(url);\n    }\n  }\n\n  handleOpenRecord(event) {\n    const { showDocumentRecord } = this.context;\n    showDocumentRecord();\n    event.nativeEvent.stopImmediatePropagation();\n  }\n\n  handleMouseMove(event) {\n    event.nativeEvent.stopImmediatePropagation();\n  }\n\n  checkOfficeFile() {\n    const { fileName } = this.props;\n    if (/\\.(doc|xls|ppt|docx|xlsx|pptx|pdf)$/.test(fileName)) {\n      return RegExp.$1;\n    }\n    return false;\n  }\n\n  render() {\n    const { fileName, fileSize, fileExtension, className } = this.props;\n\n    const documentClassName = classnames(className, 'row');\n\n    return (\n      <div className={documentClassName} ref>\n        <div className=\"document row\">\n          {this.renderIcon()}\n          <div className=\"col-xs\">\n            <span className=\"document__filename\">{fileName}</span>\n            <div className=\"document__meta\">\n              <span className=\"document__meta__size\">{fileSize}</span>\n              <span className=\"document__meta__ext\">{fileExtension}</span>\n            </div>\n            <div className=\"document__actions\">\n              {this.renderActions()}\n            </div>\n          </div>\n        </div>\n        <div className=\"col-xs\"/>\n      </div>\n    );\n  }\n}\n\nexport default Document;\n"]}