{"version":3,"sources":["../../../../src/components/dialog/messages/Photo.react.js"],"names":["Photo","props","context","state","peer","getCurrentPeer","onClick","event","preventDefault","openGroup","target","getDimentions","width","w","height","h","handleCopy","fileUrl","preview","canvas","document","createElement","ctx","getContext","img","Image","setAttribute","onload","naturalWidth","naturalHeight","drawImage","body","appendChild","dataUrl","toDataURL","sendToElectron","show","title","type","key","Date","getTime","src","downloadClick","message","isElectron","window","messenger","rid","render","console","log","bind","propTypes","string","number","isRequired","isUploading","bool","contextTypes","object"],"mappings":"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","file":"Photo.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { getDimentions, lightbox } from '../../../utils/ImageUtils';\nimport ActorClient from '../../../utils/ActorClient';\nimport DialogStore from '../../../stores/DialogStore';\n\nimport MessageAlertActionCreators from '../../../actions/MessageAlertActionCreators';\n\nclass Photo extends Component {\n  static propTypes = {\n    fileUrl: PropTypes.string,\n    w: PropTypes.number.isRequired,\n    h: PropTypes.number.isRequired,\n    preview: PropTypes.string.isRequired,\n    isUploading: PropTypes.bool.isRequired\n  };\n  \n  static contextTypes = {\n    message: PropTypes.object\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      peer: DialogStore.getCurrentPeer()\n    };\n  }\n\n  onClick(event) {\n    event.preventDefault();\n    // lightbox.open(event.target.src, 'mygroup');\n    lightbox.openGroup(event.target, 'mygroup');\n  }\n\n  getDimentions() {\n    const { w: width, h: height } = this.props;\n    return getDimentions(width, height);\n  }\n  \n  handleCopy() {\n    const { fileUrl, preview } = this.props;\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    var img = new Image();\n    img.setAttribute('crossOrigin', 'anonymous');\n    img.onload = () => {\n      canvas.width = img.naturalWidth;\n      canvas.height = img.naturalHeight;\n      ctx.drawImage(img, 0, 0);\n      document.body.appendChild(canvas);\n      var dataUrl = canvas.toDataURL();\n      ActorClient.sendToElectron('copy-image', {dataUrl});\n      MessageAlertActionCreators.show({title: '图片复制成功', type: 'success', key: new Date().getTime()})\n\n    }\n    img.src = fileUrl || preview;\n  }\n\n  downloadClick() {\n        // 点击下载\n        const { peer } = this.state;\n        const { message } = this.context;\n        if (ActorClient.isElectron()) {\n            window.messenger.sendToElectron('will-download-info', {rid: message.rid, ...peer});\n        }\n  }\n\n  render() {\n    const { fileUrl, preview } = this.props;\n    const { width, height } = this.getDimentions();\n    console.log(fileUrl, preview);\n\n    return (\n      <div className=\"message__photo__box\">\n        <img\n          className=\"message__photo\"\n          src={fileUrl || preview}\n          width={width}\n          height={height}\n          onClick={this.onClick}\n          data-jslghtbx-group=\"mygroup\"\n          data-jslghtbx={fileUrl || preview}\n        />\n        {\n          ActorClient.isElectron() ?\n          <div className=\"btn-box\">\n            <a className=\"download img-icon\" href={fileUrl || preview} onClick={this.downloadClick.bind(this)} download={fileUrl || preview} target=\"_self\">下载</a>\n            <a className=\"copy img-icon\" href=\"javascript:;\" target=\"_self\" onClick={this.handleCopy.bind(this)}>复制</a>\n          </div> : null\n        }\n      </div>\n    );\n  }\n}\n\nexport default Photo;\n"]}