{"version":3,"sources":["../../../src/components/modals/Invite.react.js"],"names":["InviteUser","getStores","calculateState","name","getState","search","step","members","selectedUserIds","group","props","context","handleClose","bind","onSearchChange","onContactSelect","onInviteUrlByClick","hide","uid","inviteUser","state","id","show","INVITE","event","setState","target","value","getContacts","contacts","filter","contact","score","renderContacts","users","length","map","isMember","currentState","SUCCESS","PENDING","onClick","console","log","contactClassName","renderSearch","intl","messages","renderHeader","inviteByLinkButton","cursor","onContactToggle","userIds","setSelectedUserIds","handleSearchChange","setGroupSearch","handleSubmit","idList","peer","handleDelete","render","contextTypes","object","create"],"mappings":"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","file":"Invite.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport Modal from 'react-modal';\nimport { Container } from 'flux/utils';\nimport fuzzaldrin from 'fuzzaldrin';\nimport classNames from 'classnames';\nimport { FormattedMessage } from 'react-intl';\n\nimport { AsyncActionStates, ModalTypes } from '../../constants/ActorAppConstants';\nimport { hasMember } from '../../utils/GroupUtils';\n\nimport InviteUserActions from '../../actions/InviteUserActions';\nimport InviteUserByLinkActions from '../../actions/InviteUserByLinkActions';\n\nimport PeopleStore from '../../stores/PeopleStore';\nimport InviteUserStore from '../../stores/InviteUserStore';\n\nimport ContactItem from '../common/ContactItem.react';\nimport Stateful from '../common/Stateful.react';\nimport GroupForm from './createGroup/Form.react';\n\nclass InviteUser extends Component {\n  static getStores() {\n    return [InviteUserStore, PeopleStore];\n  }\n\n  static calculateState() {\n    return {\n      name: InviteUserStore.getState().name,\n      search: InviteUserStore.getState().search,\n      step: InviteUserStore.getState().step,\n      members: InviteUserStore.getState().members,\n      selectedUserIds: InviteUserStore.getState().selectedUserIds,\n      group: InviteUserStore.getState().group,\n    };\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.handleClose = this.handleClose.bind(this);\n    this.onSearchChange = this.onSearchChange.bind(this);\n    this.onContactSelect = this.onContactSelect.bind(this);\n    this.onInviteUrlByClick = this.onInviteUrlByClick.bind(this);\n  }\n\n  handleClose() {\n    InviteUserActions.hide();\n  }\n\n  onContactSelect(uid) {\n    InviteUserActions.inviteUser(this.state.group.id, uid);\n  }\n\n  onInviteUrlByClick() {\n    const { group } = this.state;\n\n    InviteUserByLinkActions.show(group, ModalTypes.INVITE);\n  }\n\n  onSearchChange(event) {\n    this.setState({ search: event.target.value });\n  }\n\n  getContacts() {\n    const { contacts, search } = this.state;\n    if (!search) return contacts;\n\n    return contacts.filter((contact) => {\n      return fuzzaldrin.score(contact.name, search) > 0;\n    });\n  }\n\n  renderContacts() {\n    const { group, users } = this.state;\n    const contacts = this.getContacts();\n\n    if (!contacts.length) {\n      return (\n        <li className=\"contacts__list__item contacts__list__item--empty text-center\">\n          <FormattedMessage id=\"invite.notFound\"/>\n        </li>\n      );\n    }\n\n    return contacts.map((contact) => {\n\n      const isMember = hasMember(group.id, contact.uid);\n      const currentState = isMember ? AsyncActionStates.SUCCESS : (users[contact.uid] || AsyncActionStates.PENDING);\n\n      const onClick = () => {\n        console.log(`%c Trying to invite \"${contact.name}\"(uid=${contact.uid}) to group ${group.id}`, 'color: #fd5c52');\n        this.onContactSelect(contact.uid)\n      };\n\n      const contactClassName = classNames({\n        'contact--disabled': currentState === AsyncActionStates.SUCCESS\n      });\n\n      return (\n        <ContactItem {...contact} className={contactClassName} key={contact.uid}>\n          <Stateful\n            currentState={currentState}\n            pending={<a className=\"material-icons\" onClick={onClick}>person_add</a>}\n            processing={<i className=\"material-icons spin\">autorenew</i>}\n            success={<i className=\"material-icons\">check</i>}\n            failure={<i className=\"material-icons\">warning</i>}\n          />\n        </ContactItem>\n      );\n    });\n  }\n\n  renderSearch() {\n    const { search } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <div className=\"small-search\">\n        <i className=\"material-icons\">search</i>\n        <input className=\"input\"\n               onChange={this.onSearchChange}\n               ref=\"search\"\n               placeholder={intl.messages['invite.search']}\n               type=\"search\"\n               value={search}/>\n      </div>\n    );\n  }\n  renderHeader() {\n    return (\n      <header className=\"header\">\n        <div className=\"pull-left\"><FormattedMessage id=\"invite.title\"/></div>\n        { this.inviteByLinkButton() }\n        <div className=\"pull-right\" style={{cursor: 'Pointer'}}><strong onClick={() => this.handleClose()}>关闭</strong></div>\n      </header>\n    );\n  }\n\n  inviteByLinkButton() {\n    return (\n      <a className=\"link link--blue\" onClick={this.onInviteUrlByClick}>\n        <i className=\"material-icons\">link</i>\n        <FormattedMessage id=\"invite.inviteByLink\"/>\n      </a>\n    );\n  }\n\n  onContactToggle(userIds) {\n    InviteUserActions.setSelectedUserIds(userIds);\n  }\n  handleSearchChange(value) {\n    InviteUserActions.setGroupSearch(value);\n  }\n  handleSubmit(idList, name, peer) {\n    InviteUserActions.inviteUser(peer.id, idList);\n  }\n  handleDelete(selectedUserIds) {\n    InviteUserActions.setSelectedUserIds(selectedUserIds);\n  }\n\n  render() {\n    var props = {\n      onContactToggle: this.onContactToggle,\n      handleSearchChange: this.handleSearchChange,\n      handleDelete: this.handleDelete,\n      handleSubmit: this.handleSubmit,\n      handleClose: this.handleClose,\n      ...this.state\n    }\n    return (\n      <Modal\n        overlayClassName=\"modal-overlay\"\n        className=\"modal\"\n        onRequestClose={this.handleClose}\n        isOpen>\n\n        <div className=\"invite\">\n          <div className=\"modal__content\">\n            { this.renderHeader() }\n            <GroupForm {...props} />\n            {/* <header className=\"modal__header\">\n              <i className=\"modal__header__icon material-icons\">person_add</i>\n              <FormattedMessage id=\"invite.title\" tagName=\"h1\"/>\n              <button className=\"button button--lightblue\" onClick={this.handleClose}>\n                <FormattedMessage id=\"button.done\"/>\n              </button>\n            </header>\n\n            <div className=\"modal__body\">\n              {this.renderSearch()}\n\n              {this.inviteByLinkButton()}\n\n              <ul className=\"contacts__list\">\n                {this.renderContacts()}\n              </ul>\n            </div> */}\n\n          </div>\n        </div>\n\n      </Modal>\n    );\n  }\n}\n\nexport default Container.create(InviteUser);\n"]}