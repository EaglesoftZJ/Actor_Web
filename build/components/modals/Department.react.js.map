{"version":3,"sources":["../../../src/components/modals/Department.react.js"],"names":["RESULT_ITEM_HEIGHT","scrollIndex","Department","getStores","calculateState","res","getState","dw_data","from","where","orderBy","toArray","bm_data","yh_data","hoverId","selectedDw","selectedBm","selectedYhIndex","szk","selectedDwmc","selectedBmmc","hoverable","scrollTo","dwAll","props","context","handleClose","bind","handleDialogSelect","handleScroll","componentDidMount","setListeners","componentWillUnmount","cleanListeners","componentDidUpdate","state","setTimeout","scrollTop","$","refs","bms","position","top","setState","listeners","listen","document","handleMouseMove","forEach","listener","remove","hide","peer","peerStr","peerToString","push","results","renderYh","length","map","result","index","resultClassName","IGIMID","id","parseFloat","type","key","xm","zwmc","renderHeader","cursor","handleSelectDw","obj","handleSelectBm","handleItemHover","handleShowAll","render","onSelectDw","onSelectBm","onItemHover","onShowAll","scrollBox","contextTypes","intl","object","isRequired","create","pure"],"mappings":"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","file":"Department.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport { Container } from 'flux/utils';\r\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\r\nimport EventListener from 'fbjs/lib/EventListener';\r\nimport fuzzaldrin from 'fuzzaldrin';\r\nimport Modal from 'react-modal';\r\nimport classnames from 'classnames';\r\nimport history from '../../utils/history';\r\nimport PeerUtils from '../../utils/PeerUtils';\r\n\r\nimport { KeyCodes } from '../../constants/ActorAppConstants';\r\n\r\nimport DepartmentActionCreators from '../../actions/DepartmentActionCreators';\r\n\r\nimport DepartmentStore from '../../stores/DepartmentStore';\r\n\r\nimport DepartmentMenu from './departmentMenu/DepartmentMenu.react';\r\nimport AvatarItem from '../common/AvatarItem.react';\r\n\r\nimport linq from 'Linq';\r\n\r\nconst RESULT_ITEM_HEIGHT = 44;\r\nlet scrollIndex = 0;\r\n\r\nclass Department extends Component {\r\n  static getStores() {\r\n    return [DepartmentStore];\r\n  }\r\n\r\n  static calculateState() {\r\n    let res = DepartmentStore.getState();\r\n    return {\r\n      dw_data: linq.from(res.dw_data).where('$.id!==\"dw017\"').orderBy('$.wzh').toArray(),\r\n      bm_data: res.bm_data,\r\n      yh_data: res.yh_data,\r\n      hoverId: '',\r\n      selectedDw: '',\r\n      selectedBm: '',\r\n      selectedYhIndex: -1,\r\n      szk: '',\r\n      selectedDwmc: '',\r\n      selectedBmmc: '',\r\n      hoverable: true,\r\n      scrollTo: null,\r\n      dwAll: false\r\n    }\r\n  }\r\n\r\n  static contextTypes = {\r\n    intl: PropTypes.object.isRequired\r\n  }\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.handleClose = this.handleClose.bind(this);\r\n    this.handleDialogSelect = this.handleDialogSelect.bind(this);\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setListeners();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.cleanListeners();\r\n  }\r\n  componentDidUpdate() {\r\n    this.scrollTo();\r\n  }\r\n  scrollTo()  {\r\n   const { scrollTo } = this.state;\r\n    if (scrollTo) {\r\n      setTimeout(() => {\r\n        var scrollTop = $(this.refs.bms).scrollTop() + $(scrollTo).position().top;\r\n        $(this.refs.bms).scrollTop(scrollTop);\r\n        this.setState({scrollTo: null});\r\n      }, 10);  \r\n    }\r\n  }\r\n\r\n  setListeners() {\r\n    this.cleanListeners();\r\n    this.listeners = [\r\n      EventListener.listen(document, 'mousemove', this.handleMouseMove.bind(this))\r\n    ];\r\n  }\r\n\r\n  cleanListeners() {\r\n    if (this.listeners) {\r\n      this.listeners.forEach((listener) => listener.remove());\r\n      this.listeners = null;\r\n    }\r\n  }\r\n  handleMouseMove() {\r\n    this.setState({'hoverable': true});\r\n  }\r\n\r\n  handleClose() {\r\n    DepartmentActionCreators.hide();\r\n  }\r\n\r\n\r\n  handleDialogSelect(peer) {\r\n    const peerStr = PeerUtils.peerToString(peer);\r\n    history.push(`/im/${peerStr}`);\r\n    this.handleClose();\r\n  }\r\n  \r\n  handleScroll(top) {\r\n    findDOMNode(this.refs.results).scrollTop = top;\r\n  }\r\n\r\n\r\n  renderYh() {\r\n    const { selectedYhIndex, yh_data, hoverId, dwAll, selectedBm, selectedDw, szk } = this.state;\r\n    let results = null;\r\n    if (!dwAll) {\r\n      results = linq.from(yh_data).where('$.bmid.trim() == \"' + selectedBm + '\" && $.dwid.trim() == \"' + selectedDw + '\"&& $.szk == \"' + szk +'\"').orderBy('$.wzh').toArray();\r\n    } else {\r\n      results = linq.from(yh_data).where('$.dwid.trim() == \"' + selectedDw + '\"&& $.szk == \"' + szk +'\"').orderBy('$.wzh').toArray();\r\n    }\r\n    \r\n    if (results.length <= 0) {\r\n      return (\r\n        <li className=\"results__item results__item--suggestion row\">\r\n          <FormattedHTMLMessage id=\"modal.department.notFound\" />\r\n          <button className=\"button button--rised hide\">Create new dialog </button>\r\n        </li>\r\n      )\r\n    }\r\n    return results.map((result, index) => {\r\n      const resultClassName = classnames('results__item row', {\r\n        'results__item--active': hoverId === (result.IGIMID + result.szk)\r\n      });\r\n\r\n      return (\r\n        <li\r\n          className={resultClassName} key={`r${index}`}\r\n          onClick={() => this.handleDialogSelect(\r\n            {\r\n              id: parseFloat(result.IGIMID),\r\n              type: 'user',\r\n              key: 'u' + result.IGIMID\r\n            }\r\n          )}\r\n          onMouseOver={() => this.setState({ hoverId: (result.IGIMID + result.szk) })}>\r\n          <div className=\"title col-xs\">\r\n            <div className=\"hint pull-right\"><FormattedMessage id=\"modal.department.openDialog\" /></div>\r\n            {result.xm}{result.zwmc ? '(' + result.zwmc +')' : ''}\r\n          </div>\r\n        </li>\r\n      );\r\n    });\r\n  }\r\n\r\n  renderHeader() {\r\n    const { selectedDw, selectedDwmc, selectedBmmc } = this.state;\r\n\r\n    return (\r\n      <header className=\"header\">\r\n        <div className=\"pull-left\"><strong>{selectedDwmc}{selectedDw.length <= 0 ? <FormattedMessage id=\"modal.department.title\" /> : selectedBmmc && '-' + selectedBmmc}</strong></div>\r\n        <div className=\"pull-right\" style={{cursor: 'Pointer'}}><strong onClick={() => this.handleClose()}>关闭</strong></div>\r\n      </header>\r\n    );\r\n  }\r\n\r\n  handleSelectDw(obj) {\r\n    this.setState({...obj, dwAll: false});\r\n  }\r\n\r\n  handleSelectBm(obj) {\r\n    this.setState({...obj, dwAll: false});\r\n  }\r\n\r\n  handleItemHover(hoverId) {\r\n    this.setState({hoverId});\r\n  }\r\n\r\n  handleShowAll(obj) {\r\n    this.setState({...obj, dwAll: true});\r\n  }\r\n\r\n \r\n\r\n  render() {\r\n      const { dw_data, bm_data, hoverId} = this.state;\r\n      var props = {\r\n        dw_data,\r\n        bm_data,\r\n        hoverId,\r\n        onSelectDw: this.handleSelectDw.bind(this),\r\n        onSelectBm: this.handleSelectBm.bind(this),\r\n        onItemHover: this.handleItemHover.bind(this),\r\n        onShowAll: this.handleShowAll.bind(this),\r\n        scrollBox: this.refs.bms\r\n      }\r\n      return (\r\n        <Modal\r\n          overlayClassName=\"modal-overlay\"\r\n          className=\"modal\"\r\n          onRequestClose={this.handleClose}\r\n          isOpen>\r\n\r\n          <div className=\"department\">\r\n            <div className=\"modal__content\">\r\n\r\n              {this.renderHeader()}\r\n\r\n              <div className=\"results\">\r\n                <div className=\"dw_bm_Results\" ref=\"bms\" style={{position: 'relative'}}>\r\n                  <DepartmentMenu {...props}></DepartmentMenu>\r\n                </div>\r\n\r\n                <div className=\"yhResults\" ref=\"yhs\">\r\n                  {this.renderYh()}\r\n                </div>\r\n              </div>\r\n\r\n\r\n\r\n            </div>\r\n          </div>\r\n\r\n        </Modal>\r\n      );\r\n  }\r\n}\r\n\r\nexport default Container.create(Department, { pure: false });\r\n"]}