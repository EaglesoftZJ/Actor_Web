{"version":3,"sources":["../../../src/components/modals/DepartmentDetial.react.js"],"names":["RESULT_ITEM_HEIGHT","scrollIndex","DepartmentDetial","getStores","calculateState","res","getState","dw_data","from","where","orderBy","toArray","bm_data","yh_data","quickSearchData","getSearchList","hoverId","selectedDw","selectedBm","selectedYhIndex","selectedDwmc","selectedBmmc","hoverable","scrollTo","dwAll","props","context","handleClose","bind","handleDialogSelect","handleScroll","componentDidMount","setListeners","componentWillUnmount","cleanListeners","componentDidUpdate","state","setTimeout","scrollTop","$","refs","bms","position","top","setState","listeners","listen","document","handleMouseMove","forEach","listener","remove","hide","peer","peerStr","peerToString","push","results","renderYh","bmid","dwid","trim","join","console","log","length","map","result","index","resultClassName","department","iGIMID","id","parseFloat","type","key","user","peerInfo","avatar","placeholder","title","onClick","zwmc","xm","renderHeader","hasHeader","cursor","handleSelectDw","obj","handleSelectBm","handleItemHover","handleShowAll","render","onSelectDw","onSelectBm","onItemHover","onShowAll","scrollBox","propTypes","bool","contextTypes","intl","object","isRequired","create","withProps"],"mappings":"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","file":"DepartmentDetial.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport EventListener from 'fbjs/lib/EventListener';\nimport fuzzaldrin from 'fuzzaldrin';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport DepartmentActionCreators from '../../actions/DepartmentActionCreators';\n\nimport DepartmentStore from '../../stores/DepartmentStore';\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport DepartmentMenu from './departmentMenu/DepartmentMenu.react';\nimport AvatarItem from '../common/AvatarItem.react';\n\nimport linq from 'Linq';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass DepartmentDetial extends Component {\n    static propTypes = {\n        hasHeader: PropTypes.bool,\n    };\n\n  static getStores() {\n    return [DepartmentStore, QuickSearchStore];\n  }\n\n  static calculateState() {\n    let res = DepartmentStore.getState();\n    return {\n      dw_data: linq.from(res.dw_data).where('$.id!==\"dw017\"').orderBy('$.wzh').toArray(),\n      bm_data: res.bm_data,\n      yh_data: res.yh_data,\n      quickSearchData: QuickSearchStore.getSearchList(),\n      hoverId: '',\n      selectedDw: '',\n      selectedBm: '',\n      selectedYhIndex: -1,\n      selectedDwmc: '',\n      selectedBmmc: '',\n      hoverable: true,\n      scrollTo: null,\n      dwAll: false\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object.isRequired\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleDialogSelect = this.handleDialogSelect.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n  }\n\n  componentDidMount() {\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n  componentDidUpdate() {\n    this.scrollTo();\n  }\n  scrollTo()  {\n   const { scrollTo } = this.state;\n    if (scrollTo) {\n      setTimeout(() => {\n        var scrollTop = $(this.refs.bms).scrollTop() + $(scrollTo).position().top;\n        $(this.refs.bms).scrollTop(scrollTop);\n        this.setState({scrollTo: null});\n      }, 10);  \n    }\n  }\n\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      EventListener.listen(document, 'mousemove', this.handleMouseMove.bind(this))\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => listener.remove());\n      this.listeners = null;\n    }\n  }\n  handleMouseMove() {\n    this.setState({'hoverable': true});\n  }\n\n  handleClose() {\n    DepartmentActionCreators.hide();\n  }\n\n\n  handleDialogSelect(peer) {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  }\n  \n  handleScroll(top) {\n    findDOMNode(this.refs.results).scrollTop = top;\n  }\n\n\n  renderYh() {\n    const { selectedYhIndex, yh_data, quickSearchData, hoverId, dwAll, selectedBm, selectedDw } = this.state;\n    // console.log('user111', selectedBm, 'selectedDw', selectedDw);\n    let results = null;\n    if (!dwAll) {\n      results = linq.from(yh_data).where(($) => {\n        // console.log('user111', $.xm, $.bmid, selectedBm, $.bmid && $.bmid.trim() == selectedBm, $.dwid, selectedDw, $.dwid && $.dwid.trim() == selectedDw)\n        if ($.bmid && $.dwid) {\n          return $.bmid.trim() == selectedBm && $.dwid.trim() == selectedDw;\n    } else {\n          return false;\n    }\n      }).orderBy('$.wzh').toArray();\n    } else {\n      results = linq.from(yh_data).where('$.dwid && $.dwid.trim() == \"' + selectedDw + '\"').orderBy('$.wzh').toArray();\n    }\n    // console.log('quickSearchData', quickSearchData, results);\n    results = linq.from(results).join(quickSearchData, 'a => a.iGIMID', 'b => b.peerInfo.peer.id', 'department, user => {department: department, user: user}').toArray();\n    console.log('quickSearchData', quickSearchData, results);\n    // results = linq.from(results).join(quickSearchData, 'a => parseFloat(a.id)', 'b => b.peerInfo.peer.id', 'department, user=>{department: department, user: user}').toArray();\n    if (results.length <= 0) {\n      return (\n        <li className=\"results__item results__item--suggestion row\">\n          <FormattedHTMLMessage id=\"modal.department.notFound\" />\n          <button className=\"button button--rised hide\">Create new dialog </button>\n        </li>\n      )\n    }\n    return results.map((result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': hoverId === (result.department.iGIMID)\n      });\n\n      return (\n        <li\n          className={resultClassName} key={`r${index}`}\n          onClick={() => this.handleDialogSelect(\n            {\n              id: parseFloat(result.department.iGIMID),\n              type: 'user',\n              key: 'u' + result.department.iGIMID\n            }\n          )}\n          onMouseOver={() => this.setState({ hoverId: (result.department.iGIMID) })}>\n          <div className=\"title col-xs\">\n            {/* <div className=\"hint pull-right\"><FormattedMessage id=\"modal.department.openDialog\" /></div> */}\n            <AvatarItem\n              className=\"group_profile__avatar\"\n              size=\"small\"\n              image={result.user.peerInfo.avatar}\n              placeholder={result.user.peerInfo.placeholder}\n              title={result.user.peerInfo.title}\n              onClick={() => this.onClick(result.user.peerInfo.peer.id)}\n            />\n            <div className=\"username\" title={result.department.zwmc ? '(' + result.department.zwmc +')' : ''}>{result.department.xm}{result.department.zwmc ? ' (' + result.department.zwmc +')' : ''}</div>\n          </div>\n        </li>\n      );\n    });\n  }\n\n  renderHeader() {\n    const { selectedDw, selectedDwmc, selectedBmmc } = this.state;\n    const { hasHeader } = this.props;\n    if (!hasHeader) {\n        return null;\n    }\n\n    return (\n      <header className=\"header\">\n        <div className=\"pull-left\"><strong>{selectedDwmc}{selectedDw.length <= 0 ? <FormattedMessage id=\"modal.department.title\" /> : selectedBmmc && '-' + selectedBmmc}</strong></div>\n        <div className=\"pull-right\" style={{cursor: 'Pointer'}}><strong onClick={() => this.handleClose()}>关闭</strong></div>\n      </header>\n    );\n  }\n\n  handleSelectDw(obj) {\n    this.setState({...obj, dwAll: false});\n  }\n\n  handleSelectBm(obj) {\n    this.setState({...obj, dwAll: false});\n  }\n\n  handleItemHover(hoverId) {\n    this.setState({hoverId});\n  }\n\n  handleShowAll(obj) {\n    this.setState({...obj, dwAll: true});\n  }\n\n \n\n  render() {\n      const { dw_data, bm_data, yh_data, hoverId} = this.state;\n      var props = {\n        dw_data,\n        bm_data,\n        yh_data,\n        hoverId,\n        onSelectDw: this.handleSelectDw.bind(this),\n        onSelectBm: this.handleSelectBm.bind(this),\n        onItemHover: this.handleItemHover.bind(this),\n        onShowAll: this.handleShowAll.bind(this),\n        scrollBox: this.refs.bms\n      }\n      return (\n        <div className=\"department-detial\">\n            {this.renderHeader()}\n            <div className=\"results\">\n                <div className=\"dw_bm_Results\" ref=\"bms\" style={{position: 'relative'}}>\n                    <DepartmentMenu {...props} />\n                </div>\n\n                <div className=\"yhResults\" ref=\"yhs\">\n                    {this.renderYh()}\n                </div>\n            </div>\n        </div>\n      );\n  }\n}\n\nexport default Container.create(DepartmentDetial, { withProps: true });\n"]}