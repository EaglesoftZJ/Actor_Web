{"version":3,"sources":["../../../../src/components/modals/departmentMenu/DepartmentMenu.react.js"],"names":["DepartementItem","props","state","selectedDw","selectedDwmc","selectedBm","selectedBmmc","szk","scrollTo","hoverable","componentDidMount","setListeners","componentWillUnmount","cleanListeners","componentDidUpdate","listeners","listen","document","handleMouseMove","bind","forEach","listener","remove","setState","scrollBox","setTimeout","scrollTop","position","top","renderDw","dw_data","hoverId","length","map","result","index","itemId","id","selected","hover","resultClassName","event","dwSelect","mc","handleMouseOver","renderBm","dwId","szk1","parentId","bm_data","results","from","where","orderBy","toArray","bmSelect","dwid","dwmc","onSelectDw","_dwid","_dwmc","_szk","_bmid","_bmmc","_hoverable","_scrollTo","console","log","title","target","parents","bmid","bmmc","onSelectBm","data","onItemHover","render","PropTypes","array","isRequired","string","func","element"],"mappings":"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","file":"DepartmentMenu.react.js","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport EventListener from 'fbjs/lib/EventListener';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport $ from 'jquery';\nimport linq from 'Linq';\n\nclass DepartementItem extends Component {\n    static PropTypes = {\n        dw_data: PropTypes.array.isRequired,\n        bm_data: PropTypes.array.isRequired,\n        hoverId: PropTypes.string,\n        onSelectDw: PropTypes.func,\n        onSelectBm: PropTypes.func,\n        onItemHover: PropTypes.func,\n        scrollBox: PropTypes.element\n    }\n    \n\n    constructor(props) {\n        super(props);\n        \n        this.state = {\n            selectedDw: -1,\n            selectedDwmc: '',\n            selectedBm: -1,\n            selectedBmmc: '',\n            szk: '',\n            scrollTo: null,\n            hoverable: true\n        }\n    }\n    componentDidMount() {\n        this.setListeners();\n    }\n    componentWillUnmount() {\n        this.cleanListeners();\n    }\n    componentDidUpdate() {\n        this.scrollTo();\n    }\n    setListeners() {\n        this.cleanListeners();\n        this.listeners = [\n          EventListener.listen(document, 'mousemove', this.handleMouseMove.bind(this))\n        ];\n    }    \n\n    cleanListeners() {\n        if (this.listeners) {\n          this.listeners.forEach((listener) => listener.remove());\n          this.listeners = null;\n        }\n    }\n    handleMouseMove() {\n        this.setState({'hoverable': true});\n    }\n\n    scrollTo()  {\n        const { scrollTo } = this.state;\n        const { scrollBox } = this.props\n         if (scrollTo) {\n           setTimeout(() => {\n             var scrollTop = $(scrollBox).scrollTop() + $(scrollTo).position().top;\n             $(scrollBox).scrollTop(scrollTop);\n             this.setState({scrollTo: null});\n           }, 10);  \n        }\n    }\n\n    renderDw() {\n        const { dw_data, hoverId } = this.props;\n        const { selectedDw, szk } = this.state;\n        if (dw_data && dw_data.length <= 0) {\n          return (\n            <li className=\"results__item--suggestion row\">\n              <FormattedHTMLMessage id=\"modal.department.notFound\" />\n              <button className=\"button button--rised hide\">Create new dialog</button>\n            </li>\n          )\n        }\n    \n        return dw_data.map((result, index) => {\n          const itemId = result.id + result.szk;\n          const selected = (selectedDw + szk) === itemId;\n          const hover = hoverId === itemId;\n          const resultClassName = classnames('results__item row', {\n            'results__item--active': hover,\n            'results__item--open': selected\n          });\n        //   const iconClassName = classnames('material-icons icon', hover ? 'icon--blue' : 'icon--blue');\n    \n          return (\n            <li\n              className=\"results__dw\"\n              style={{'position': 'relative'}}\n              key={`r${index}`}>\n              <div className={resultClassName} \n              onClick={(event) => this.dwSelect(result.id, result.mc, result.szk, event)}\n              onMouseOver={this.handleMouseOver.bind(this, result.id, result.szk)}>\n                <div className=\"title col-xs\">\n                    {result.mc}\n                    {/* {result.mc} <i className={ iconClassName }>business</i> */}\n                </div>\n                <div className=\"arrow\"></div>\n              </div>\n              <div className=\"children-box\">\n              { selected ? this.renderBm(result.id, result.szk, -1) : null }\n              </div>\n            </li>\n          );\n        });\n      }\n\n    renderBm(dwId, szk1, parentId) {\n        const { bm_data, hoverId } = this.props;\n        const { selectedBm, szk} = this.state;\n\n        let results = linq.from(bm_data).where('$.dwid.trim() == \"' + dwId + '\" && $.fid.trim() == \"' + parentId + '\" && $.szk ==' + '\"' + szk1 + '\"').orderBy('$.wzh').toArray();\n    \n        if (results.length <= 0) {\n            return null;\n        }\n    \n\n        return results.map((result, index) => {\n            const itemId = result.id + result.szk;\n            const selected = (selectedBm + szk) === itemId;\n            const hover = hoverId === itemId;\n            const resultClassName = classnames('results__item row', {\n            'results__item--active': hover,\n            'results__item--selected': selected\n            });\n\n            return (\n                <div key={result.id + result.szk} className=\"results__bm\">\n                    <div\n                    className={resultClassName} key={`r${index}`}\n                    onClick={() => this.bmSelect(result.id, result.mc)}\n                    onMouseOver={this.handleMouseOver.bind(this, result.id, result.szk)}>\n                    <div className=\"title col-xs\">\n                        {result.mc}\n                    </div>\n                    </div>\n                    <div className=\"children-box\">\n                    {this.renderBm(dwId, szk1, result.id)}\n                    </div>\n                </div>\n            );\n        });\n    }\n    dwSelect(dwid, dwmc, szk, event) {\n        const { selectedDw, selectedDwmc } = this.state;\n        const { onSelectDw, bm_data } = this.props;\n        var hoverable = false,\n            _dwid = '',\n            _dwmc = '',\n            _szk = '',\n            _bmid = '',\n            _bmmc = '',\n            _hoverable = true,\n            _scrollTo = null; \n        if (selectedDw !== dwid || selectedDwmc !== dwmc) {\n            console.log('open');\n            var results = linq.from(bm_data).where('$.dwid.trim() == \"' + dwid + '\" && $.fid.trim() == \"-1\" && $.szk ==' + '\"' + szk + '\"').orderBy('$.wzh').toArray();\n            _dwid = dwid;\n            _dwmc = dwmc;\n            _szk = szk;\n            _bmid = results.length > 0 ? results[0].id : '';\n            _bmmc = results.length > 0 ? results[0].title : '';\n            _hoverable = false;\n            _scrollTo = $(event.target).parents('li');\n        }\n        this.setState({ \n          selectedDw: _dwid,\n          selectedDwmc: _dwmc, \n          selectedBm: _bmid,\n          selectedBmmc: _bmmc,\n          scrollTo: _scrollTo,\n          szk: _szk,\n          hoverable: _hoverable\n        });\n        onSelectDw && onSelectDw({\n            selectedDw: _dwid,\n            selectedDwmc: _dwmc, \n            selectedBm: _bmid,\n            selectedBmmc: _bmmc,\n            szk: _szk\n        });\n    }\n\n    bmSelect(bmid, bmmc) {\n        const { onSelectBm } = this.props;\n        const { selectedDw, selectedDwmc, szk} = this.state;\n        var data = {\n            selectedBm: bmid, \n            selectedBmmc: bmmc\n        }\n        this.setState(data);\n        onSelectBm && onSelectBm({selectedDw, selectedDwmc, szk, ...data});\n    }\n\n    handleMouseOver(id, szk) {\n        const { onItemHover } = this.props;\n        const { hoverable } = this.state;\n        var hoverId = id + szk;\n        hoverable && onItemHover && onItemHover(hoverId);\n    }\n\n    render() {\n        return (\n            <ul className=\"department-menu\">\n                { this.renderDw() }\n            </ul>\n        );\n    }\n}\nexport default DepartementItem;"]}