{"version":3,"sources":["../../../../src/components/modals/departmentMenu/DepartmentMenu.react.js"],"names":["DepartementItem","props","state","selectedDw","selectedDwmc","selectedBm","selectedBmmc","szk","scrollTo","hoverable","innerHoverId","componentDidMount","setListeners","componentWillUnmount","cleanListeners","componentDidUpdate","listeners","listen","document","handleMouseMove","bind","forEach","listener","remove","setState","scrollBox","setTimeout","scrollTop","position","top","renderDw","dw_data","hoverId","_hoverId","undefined","length","map","result","index","itemId","id","selected","hover","resultClassName","event","dwSelect","mc","handleMouseOver","renderBm","dwId","szk1","parentId","bm_data","results","from","where","orderBy","toArray","bmSelect","dwid","dwmc","onSelectDw","_dwid","_dwmc","_szk","_bmid","_bmmc","_hoverable","_scrollTo","console","log","title","target","parents","bmid","bmmc","onSelectBm","data","onItemHover","render","PropTypes","array","isRequired","string","func","element"],"mappings":"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","file":"DepartmentMenu.react.js","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport classnames from 'classnames';\nimport EventListener from 'fbjs/lib/EventListener';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport $ from 'jquery';\nimport linq from 'Linq';\n\nclass DepartementItem extends Component {\n    static PropTypes = {\n        dw_data: PropTypes.array.isRequired,\n        bm_data: PropTypes.array.isRequired,\n        hoverId: PropTypes.string,\n        onSelectDw: PropTypes.func,\n        onSelectBm: PropTypes.func,\n        onItemHover: PropTypes.func,\n        scrollBox: PropTypes.element\n    }\n    \n\n    constructor(props) {\n        super(props);\n        \n        this.state = {\n            selectedDw: -1,\n            selectedDwmc: '',\n            selectedBm: -1,\n            selectedBmmc: '',\n            szk: '',\n            scrollTo: null,\n            hoverable: true,\n            innerHoverId: ''\n        }\n    }\n    componentDidMount() {\n        this.setListeners();\n    }\n    componentWillUnmount() {\n        this.cleanListeners();\n    }\n    componentDidUpdate() {\n        this.scrollTo();\n    }\n    setListeners() {\n        this.cleanListeners();\n        this.listeners = [\n          EventListener.listen(document, 'mousemove', this.handleMouseMove.bind(this))\n        ];\n    }    \n\n    cleanListeners() {\n        if (this.listeners) {\n          this.listeners.forEach((listener) => listener.remove());\n          this.listeners = null;\n        }\n    }\n    handleMouseMove() {\n        this.setState({'hoverable': true});\n    }\n\n    scrollTo()  {\n        const { scrollTo } = this.state;\n        const { scrollBox } = this.props\n         if (scrollTo) {\n           setTimeout(() => {\n             var scrollTop = $(scrollBox).scrollTop() + $(scrollTo).position().top;\n             $(scrollBox).scrollTop(scrollTop);\n             this.setState({scrollTo: null});\n           }, 10);  \n        }\n    }\n\n    renderDw() {\n        const { dw_data, hoverId } = this.props;\n        const { selectedDw, szk, innerHoverId } = this.state;\n        var _hoverId = hoverId === undefined ? innerHoverId : hoverId;\n        if (dw_data && dw_data.length <= 0) {\n          return (\n            <li className=\"results__item--suggestion row\">\n              <FormattedHTMLMessage id=\"modal.department.notFound\" />\n              <button className=\"button button--rised hide\">Create new dialog</button>\n            </li>\n          )\n        }\n    \n        return dw_data.map((result, index) => {\n          const itemId = result.id + result.szk;\n          const selected = (selectedDw + szk) === itemId;\n          const hover = _hoverId === itemId;\n          const resultClassName = classnames('results__item row', {\n            'results__item--active': hover,\n            'results__item--open': selected\n          });\n        //   const iconClassName = classnames('material-icons icon', hover ? 'icon--blue' : 'icon--blue');\n    \n          return (\n            <li\n              className=\"results__dw\"\n              style={{'position': 'relative'}}\n              key={`r${index}`}>\n              <div className={resultClassName} \n              onClick={(event) => this.dwSelect(result.id, result.mc, result.szk, event)}\n              onMouseOver={this.handleMouseOver.bind(this, result.id, result.szk)}>\n                <div className=\"title col-xs\">\n                    {result.mc}\n                    {/* {result.mc} <i className={ iconClassName }>business</i> */}\n                </div>\n                <div className=\"arrow\"></div>\n              </div>\n              <div className=\"children-box\">\n              { selected ? this.renderBm(result.id, result.szk, -1) : null }\n              </div>\n            </li>\n          );\n        });\n      }\n\n    renderBm(dwId, szk1, parentId) {\n        const { bm_data, hoverId } = this.props;\n        const { selectedBm, szk, innerHoverId} = this.state;\n        var _hoverId = hoverId === undefined ? innerHoverId : hoverId;\n\n        let results = linq.from(bm_data).where('$.dwid.trim() == \"' + dwId + '\" && $.fid.trim() == \"' + parentId + '\" && $.szk ==' + '\"' + szk1 + '\"').orderBy('$.wzh').toArray();\n    \n        if (results.length <= 0) {\n            return null;\n        }\n    \n\n        return results.map((result, index) => {\n            const itemId = result.id + result.szk;\n            const selected = (selectedBm + szk) === itemId;\n            const hover = _hoverId === itemId;\n            const resultClassName = classnames('results__item row', {\n            'results__item--active': hover,\n            'results__item--selected': selected\n            });\n\n            return (\n                <div key={result.id + result.szk} className=\"results__bm\">\n                    <div\n                    className={resultClassName} key={`r${index}`}\n                    onClick={() => this.bmSelect(result.id, result.mc)}\n                    onMouseOver={this.handleMouseOver.bind(this, result.id, result.szk)}>\n                    <div className=\"title col-xs\">\n                        {result.mc}\n                    </div>\n                    </div>\n                    <div className=\"children-box\">\n                    {this.renderBm(dwId, szk1, result.id)}\n                    </div>\n                </div>\n            );\n        });\n    }\n    dwSelect(dwid, dwmc, szk, event) {\n        const { selectedDw, selectedDwmc } = this.state;\n        const { onSelectDw, bm_data } = this.props;\n        var hoverable = false,\n            _dwid = '',\n            _dwmc = '',\n            _szk = '',\n            _bmid = '',\n            _bmmc = '',\n            _hoverable = true,\n            _scrollTo = null; \n        if (selectedDw !== dwid || selectedDwmc !== dwmc) {\n            console.log('open');\n            var results = linq.from(bm_data).where('$.dwid.trim() == \"' + dwid + '\" && $.fid.trim() == \"-1\" && $.szk ==' + '\"' + szk + '\"').orderBy('$.wzh').toArray();\n            _dwid = dwid;\n            _dwmc = dwmc;\n            _szk = szk;\n            _bmid = results.length > 0 ? results[0].id : '';\n            _bmmc = results.length > 0 ? results[0].title : '';\n            _hoverable = false;\n            _scrollTo = $(event.target).parents('li');\n        }\n        this.setState({ \n          selectedDw: _dwid,\n          selectedDwmc: _dwmc, \n          selectedBm: _bmid,\n          selectedBmmc: _bmmc,\n          scrollTo: _scrollTo,\n          szk: _szk,\n          hoverable: _hoverable\n        });\n        onSelectDw && onSelectDw({\n            selectedDw: _dwid,\n            selectedDwmc: _dwmc, \n            selectedBm: _bmid,\n            selectedBmmc: _bmmc,\n            szk: _szk\n        });\n    }\n\n    bmSelect(bmid, bmmc) {\n        const { onSelectBm } = this.props;\n        const { selectedDw, selectedDwmc, szk} = this.state;\n        var data = {\n            selectedBm: bmid, \n            selectedBmmc: bmmc\n        }\n        this.setState(data);\n        onSelectBm && onSelectBm({selectedDw, selectedDwmc, szk, ...data});\n    }\n\n    handleMouseOver(id, szk) {\n        const { onItemHover } = this.props;\n        const { hoverable } = this.state;\n        var hoverId = id + szk;\n        if (onItemHover === undefined) {\n            this.setState({innerHoverId: hoverId});\n        }\n        hoverable && onItemHover && onItemHover(hoverId);\n    }\n\n    render() {\n        return (\n            <ul className=\"department-menu\">\n                { this.renderDw() }\n            </ul>\n        );\n    }\n}\nexport default DepartementItem;"]}