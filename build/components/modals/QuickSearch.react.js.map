<<<<<<< HEAD
{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":["RESULT_ITEM_HEIGHT","scrollIndex","QuickSearch","getStores","calculateState","list","getState","selectedIndex","props","context","setFocus","bind","handleClose","handleSearch","handleDialogSelect","handleKeyDown","handleScroll","componentDidMount","setListeners","componentWillUnmount","cleanListeners","listeners","listen","document","forEach","listener","remove","setImmediate","refs","query","focus","hide","event","setState","target","value","peer","peerStr","peerToString","push","state","results","getResults","visibleItems","index","keyCode","ENTER","stopPropagation","preventDefault","peerInfo","ARROW_UP","length","ARROW_DOWN","TAB","top","scrollTop","Console","log","filter","result","score","title","userName","renderResults","map","resultClassName","avatar","placeholder","renderHeader","cursor","renderSearchInput","intl","messages","render","contextTypes","object","isRequired","create","pure"],"mappings":"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","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport EventListener from 'fbjs/lib/EventListener';\nimport fuzzaldrin from 'fuzzaldrin';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport QuickSearchActionCreators from '../../actions/QuickSearchActionCreators';\n\nimport QuickSearchStore from '../../stores/QuickSearchStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  static getStores() {\n    return [QuickSearchStore];\n  }\n\n  static calculateState() {\n    return {\n      list: QuickSearchStore.getState(),\n      selectedIndex: 0\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object.isRequired\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.setFocus = this.setFocus.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleSearch = this.handleSearch.bind(this);\n    this.handleDialogSelect = this.handleDialogSelect.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n  }\n\n  componentDidMount() {\n    this.setFocus();\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      EventListener.listen(document, 'keydown', this.handleKeyDown)\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => listener.remove());\n      this.listeners = null;\n    }\n  }\n\n  setFocus() {\n    setImmediate(() => findDOMNode(this.refs.query).focus());\n  }\n\n  handleClose() {\n    QuickSearchActionCreators.hide();\n  }\n\n  handleSearch(event) {\n    this.setState({ query: event.target.value });\n  }\n\n  handleDialogSelect(peer) {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  }\n\n  handleKeyDown(event) {\n    const { selectedIndex } = this.state;\n    const results = this.getResults();\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n\n      default:\n    }\n  }\n\n  handleScroll(top) {\n    findDOMNode(this.refs.results).scrollTop = top;\n\n    Console.log('scroll--------');\n  }\n\n  getResults() {\n    const { list, query } = this.state;\n    if (!query || query === '') return list;\n\n    return list.filter((result) => {\n      return fuzzaldrin.score(result.peerInfo.title, query) > 0 ||\n             fuzzaldrin.score(result.peerInfo.userName, query) > 0;\n    });\n  }\n\n  renderResults() {\n    const { selectedIndex, query } = this.state;\n    const results = this.getResults();\n\n    if (!results.length) {\n      return (\n        <li className=\"results__item results__item--suggestion row\">\n          <FormattedHTMLMessage id=\"modal.quickSearch.notFound\" values={{ query }}/>\n          <button className=\"button button--rised hide\">Create new dialog {query}</button>\n        </li>\n      )\n    }\n\n    return results.map((result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li\n          className={resultClassName} key={`r${index}`}\n          onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n          onMouseOver={() => this.setState({ selectedIndex: index })}>\n          <AvatarItem\n            className=\"quick-search__avatar\"\n            size=\"small\"\n            image={result.peerInfo.avatar}\n            placeholder={result.peerInfo.placeholder}\n            title={result.peerInfo.title}\n          />\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\"><FormattedMessage id=\"modal.quickSearch.openDialog\"/></div>\n            {result.peerInfo.title}\n          </div>\n        </li>\n      );\n    });\n  }\n\n  renderHeader() {\n    return (\n      <header className=\"header\">\n        <div className=\"pull-left\"><FormattedMessage id=\"modal.quickSearch.title\"/></div>\n        <div className=\"pull-right\" style={{cursor: 'Pointer'}}><strong onClick={() => this.handleClose()}>关闭</strong></div>\n      </header>\n    );\n  }\n\n  renderSearchInput() {\n    const { query } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <div className=\"large-search\">\n        <input\n          className=\"input\"\n          type=\"text\"\n          placeholder={intl.messages['modal.quickSearch.placeholder']}\n          onChange={this.handleSearch}\n          value={query}\n          ref=\"query\"/>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <Modal\n        overlayClassName=\"modal-overlay\"\n        className=\"modal\"\n        onRequestClose={this.handleClose}\n        isOpen>\n\n        <div className=\"quick-search\">\n          <div className=\"modal__content\">\n\n            {this.renderHeader()}\n\n            {this.renderSearchInput()}\n\n            <ul className=\"results\" ref=\"results\">\n              {this.renderResults()}\n            </ul>\n\n          </div>\n        </div>\n\n      </Modal>\n    );\n  }\n}\n\nexport default Container.create(QuickSearch, { pure: false });\n"]}
=======
{"version":3,"sources":["../../../src/components/modals/QuickSearch.react.js"],"names":["RESULT_ITEM_HEIGHT","scrollIndex","QuickSearch","getStores","calculateState","obj","getState","department","selectedLetter","selectedIndex","selectedUserId","node","isShow","props","context","handleMouseEnter","id","event","stopPropagation","setState","target","handleMouseMove","nativeEvent","stopImmediatePropagation","popoverHide","state","setFocus","bind","handleClose","handleSearch","handleDialogSelect","handleKeyDown","handleScroll","componentDidMount","setListeners","componentWillUnmount","cleanListeners","listeners","listen","document","refs","results","forEach","listener","remove","setImmediate","query","focus","hide","value","peer","peerStr","peerToString","push","getResults","visibleItems","index","keyCode","ENTER","preventDefault","peerInfo","ARROW_UP","length","ARROW_DOWN","TAB","top","scrollTop","handleLetterClick","letter","list","filter","result","score","title","userName","renderResults","map","resultClassName","avatar","placeholder","renderInfo","yh_data","info","from","where","toArray","renderHeader","cursor","renderSearchInput","intl","messages","renderSearchLetter","items","i","String","fromCharCode","itemClassName","render","contextTypes","object","isRequired","create","pure"],"mappings":"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","file":"QuickSearch.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Container } from 'flux/utils';\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\nimport EventListener from 'fbjs/lib/EventListener';\nimport fuzzaldrin from 'fuzzaldrin';\nimport Modal from 'react-modal';\nimport classnames from 'classnames';\nimport history from '../../utils/history';\nimport PeerUtils from '../../utils/PeerUtils';\nimport linq from 'Linq';\n\nimport { KeyCodes } from '../../constants/ActorAppConstants';\n\nimport PingyinSearchActionCreators from '../../actions/PingyinSearchActionCreators';\n\nimport PingyinSearchStore from '../../stores/PingyinSearchStore';\nimport DepartmentStore from '../../stores/DepartmentStore';\n\nimport AvatarItem from '../common/AvatarItem.react';\nimport Popover from '../common/Popover.react';\nimport ContactDetails from '../common/ContactDetails.react';\n\nconst RESULT_ITEM_HEIGHT = 44;\nlet scrollIndex = 0;\n\nclass QuickSearch extends Component {\n  static getStores() {\n    return [PingyinSearchStore];\n  }\n\n  static calculateState() {\n    return {\n      obj: PingyinSearchStore.getState(),\n      department: DepartmentStore.getState(),\n      selectedLetter: 'a',\n      selectedIndex: 0,\n      selectedUserId: -1,\n      node: null,\n      isShow: false\n    }\n  }\n\n  static contextTypes = {\n    intl: PropTypes.object.isRequired\n  }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.setFocus = this.setFocus.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n    this.handleSearch = this.handleSearch.bind(this);\n    this.handleDialogSelect = this.handleDialogSelect.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n  }\n\n  componentDidMount() {\n    // this.setFocus();\n    this.setListeners();\n  }\n\n  componentWillUnmount() {\n    this.cleanListeners();\n  }\n\n  setListeners() {\n    this.cleanListeners();\n    this.listeners = [\n      // EventListener.listen(document, 'keydown', this.handleKeyDown),\n      EventListener.listen(document, 'mousemove', this.popoverHide),\n      EventListener.listen(this.refs.results, 'scroll', this.popoverHide)\n    ];\n  }\n\n  cleanListeners() {\n    if (this.listeners) {\n      this.listeners.forEach((listener) => listener.remove());\n      this.listeners = null;\n    }\n  }\n\n  setFocus() {\n    setImmediate(() => findDOMNode(this.refs.query).focus());\n  }\n\n  handleClose() {\n    PingyinSearchActionCreators.hide();\n  }\n\n  handleSearch(event) {\n    this.setState({ query: event.target.value });\n  }\n\n  handleDialogSelect(peer) {\n    const peerStr = PeerUtils.peerToString(peer);\n    history.push(`/im/${peerStr}`);\n    this.handleClose();\n  }\n\n  handleKeyDown(event) {\n    const { selectedIndex } = this.state;\n    const results = this.getResults();\n    const visibleItems = 8;\n    let index = selectedIndex;\n\n    switch (event.keyCode) {\n      case KeyCodes.ENTER:\n        event.stopPropagation();\n        event.preventDefault();\n        this.handleDialogSelect(results[selectedIndex].peerInfo.peer);\n        break;\n\n      case KeyCodes.ARROW_UP:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index > 0) {\n          index -= 1;\n        } else if (index === 0) {\n          index = results.length - 1;\n        }\n\n        if (scrollIndex > index) {\n          scrollIndex = index;\n        } else if (index === results.length - 1) {\n          scrollIndex = results.length - visibleItems;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n      case KeyCodes.ARROW_DOWN:\n      case KeyCodes.TAB:\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (index < results.length - 1) {\n          index += 1;\n        } else if (index === results.length - 1) {\n          index = 0;\n        }\n\n        if (index + 1 > scrollIndex + visibleItems) {\n          scrollIndex = index + 1 - visibleItems;\n        } else if (index === 0) {\n          scrollIndex = 0;\n        }\n\n        this.handleScroll(scrollIndex * RESULT_ITEM_HEIGHT);\n        this.setState({ selectedIndex: index });\n        break;\n\n      default:\n    }\n  }\n\n  handleScroll(top) {\n    findDOMNode(this.refs.results).scrollTop = top;\n\n    // Console.log('scroll--------');\n  }\n\n  handleLetterClick(letter) {\n    this.setState({'selectedLetter': letter});\n    this.handleScroll(0);\n  }\n\n  handleMouseEnter = (id, event) => {\n    event.stopPropagation();\n    this.setState({'isShow': true, 'node': event.target, 'selectedUserId': id });\n  }\n\n  handleMouseMove = event => {\n    event.nativeEvent.stopImmediatePropagation();\n  }\n\n  popoverHide = event => {\n    const { isShow } = this.state;\n    if (isShow) {\n      this.setState({'isShow': false});\n    }\n  }\n\n  getResults() {\n    const { list } = this.state;\n    if (!query || query === '') return list;\n\n    return list.filter((result) => {\n      return fuzzaldrin.score(result.peerInfo.title, query) > 0 ||\n             fuzzaldrin.score(result.peerInfo.userName, query) > 0;\n    });\n  }\n\n  renderResults() {\n    const { selectedIndex, selectedLetter, obj } = this.state;\n    const results = obj[selectedLetter];\n\n    if (!results || !results.length) {\n      return (\n        <li className=\"results__item results__item--suggestion row\">\n          <FormattedHTMLMessage id=\"modal.quickSearch.notHaveData\"/>\n          <button className=\"button button--rised hide\">Create new dialog</button>\n        </li>\n      )\n    }\n\n    return results.map((result, index) => {\n      const resultClassName = classnames('results__item row', {\n        'results__item--active': selectedIndex === index\n      });\n\n      return (\n        <li\n          className={resultClassName} key={`r${index}`}\n          onClick={() => this.handleDialogSelect(result.peerInfo.peer)}\n          onMouseOver={() => this.setState({ selectedIndex: index})}>\n          <AvatarItem\n            className=\"quick-search__avatar\"\n            size=\"small\"\n            image={result.peerInfo.avatar}\n            placeholder={result.peerInfo.placeholder}\n            title={result.peerInfo.title}\n          />\n          <div className=\"title col-xs\">\n            <div className=\"hint pull-right\"><FormattedMessage id=\"modal.quickSearch.openDialog\"/></div>\n            {result.peerInfo.title}\n            <a href=\"javascript:;\" target=\"_self\" className=\"results__item__info\" onMouseMove={this.handleMouseMove} onMouseEnter={this.handleMouseEnter.bind(this, result.peerInfo.peer.id)}><i className=\"account-icon material-icons\">account_circle</i></a>\n          </div>\n        </li>\n      );\n    });\n  }\n\n  renderInfo() {\n    const { department, selectedUserId } = this.state;\n    const { yh_data } = department;\n    let info = linq.from(yh_data).where('parseFloat($.IGIMID) ==' + selectedUserId).toArray()[0];\n    if (!info) return null;\n    return (\n      <ContactDetails peerInfo={info}></ContactDetails>\n    )\n  }\n\n  renderHeader() {\n    return (\n      <header className=\"header\">\n        <div className=\"pull-left\"><FormattedMessage id=\"modal.quickSearch.title\"/></div>\n        <div className=\"pull-right\" style={{cursor: 'Pointer'}}><strong onClick={() => this.handleClose()}>关闭</strong></div>\n      </header>\n    );\n  }\n\n  renderSearchInput() {\n    const { query } = this.state;\n    const { intl } = this.context;\n\n    return (\n      <div className=\"large-search\">\n        <input\n          className=\"input\"\n          type=\"text\"\n          placeholder={intl.messages['modal.quickSearch.placeholder']}\n          onChange={this.handleSearch}\n          value={query}\n          ref=\"query\"/>\n      </div>\n    );\n  }\n  renderSearchLetter() {\n    const { selectedLetter } = this.state;\n    let items = [];\n    for (let i = 0; i < 27; i++) {\n      let letter = i < 26 ? String.fromCharCode(97 + i) : '其他';\n      let itemClassName = classnames('search-letter-item', {'selected': selectedLetter === letter, 'flex3': i === 26});\n      items.push(<a href=\"javascript:;\" key={i} target=\"self\" onClick={this.handleLetterClick.bind(this, letter)} className={itemClassName}>{letter}</a>);\n    }\n    \n    return (\n      <div className=\"search-letter\">\n        { items }\n      </div>\n    )\n \n  }\n\n  render() {\n    const { isShow, node } = this.state;\n    return (\n      <Modal\n        overlayClassName=\"modal-overlay\"\n        className=\"modal\"\n        onRequestClose={this.handleClose}\n        isOpen>\n        <div className=\"popover-outer\">\n\n          <Popover node={node} isShow={isShow}>\n            { this.renderInfo() }\n          </Popover>\n\n          <div className=\"quick-search\">\n            <div className=\"modal__content\">\n\n              {this.renderHeader()}\n\n              {/*this.renderSearchInput()*/}\n              { this.renderSearchLetter() }\n              \n\n              <ul className=\"results\" ref=\"results\">\n                {this.renderResults()}\n              </ul>\n\n            </div>\n          </div>\n        </div>\n\n      </Modal>\n    );\n  }\n}\n\nexport default Container.create(QuickSearch, { pure: false });\n"]}
>>>>>>> 88210f93a9268ceacb9221b81a80f1430f078461
