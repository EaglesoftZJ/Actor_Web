{"version":3,"sources":["../../src/components/Sidebar.react.js"],"names":["Sidebar","getStores","calculateState","currentPeer","getCurrentPeer","dialogs","getDialogs","archive","getArchiveChatState","pingyinSearch","getState","props","components","getComponents","get","sidebar","Recent","recent","DepSection","FooterSection","filterDailogs","state","group","newDialog","obj","i","length","extend","push","key","arr","from","shorts","where","toArray","arr1","activeGroup","join","concat","sort","a","b","updateTime","render","create","pure"],"mappings":"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","file":"Sidebar.react.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { isFunction } from 'lodash';\nimport React, { Component } from 'react';\nimport { Container } from 'flux/utils';\nimport DelegateContainer from '../utils/DelegateContainer';\n\nimport DefaultRecent from './sidebar/Recent.react';\nimport QuickSearchButton from './sidebar/QuickSearchButton.react';\nimport Department from './sidebar/DepartmentButton.react';\n\nimport DialogStore from '../stores/DialogStore';\nimport PingyinSearchStore from '../stores/PingyinSearchStore';\nimport ArchiveStore from '../stores/ArchiveStore';\nimport linq from 'linq';\nimport $ from 'jquery';\n\nclass Sidebar extends Component {\n  static getStores() {\n    return [DialogStore, PingyinSearchStore, ArchiveStore];\n  }\n\n  static calculateState() {\n    return {\n      currentPeer: DialogStore.getCurrentPeer(),\n      dialogs: DialogStore.getDialogs(),\n      archive: ArchiveStore.getArchiveChatState(),\n      pingyinSearch: PingyinSearchStore.getState()\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.components = this.getComponents();\n  }\n\n  getComponents() {\n    const { components } = DelegateContainer.get();\n    const sidebar = components.sidebar;\n\n    if (sidebar) {\n      return {\n        Recent: isFunction(sidebar.recent) ? sidebar.recent : DefaultRecent,\n        DepSection: Department,\n        FooterSection: QuickSearchButton\n        \n      };\n    }\n\n    return {\n      Recent: DefaultRecent,\n      DepSection: Department,\n      FooterSection: QuickSearchButton\n    };\n  }\n\n  filterDailogs() {\n    // 过滤删除的群组\n    const { dialogs, pingyinSearch } = this.state;\n    let group = pingyinSearch['群组'] || [];\n    var newDialog = [],\n        obj = {};\n    for (var i = 0; i < dialogs.length; i++) {\n      obj = $.extend({}, dialogs[i]);\n      newDialog.push(obj);\n      if (dialogs[i].key !== 'privates') {\n        // 非用户组\n        var arr = linq.from(dialogs[i].shorts).where('$.peer.peer.type === \"group\"').toArray(); // 群组部分\n        var arr1 = linq.from(dialogs[i].shorts).where('$.peer.peer.type !== \"group\"').toArray(); // 非群组部分\n        var activeGroup = linq.from(arr).join(group, 'outer => outer.peer.peer.id', 'inner => inner.peerInfo.peer.id', 'outer => outer').toArray(); // 未删除群组\n        obj.shorts = [].concat(...arr1, ...activeGroup); // 重新组合\n        obj.shorts.sort((a, b) => {\n          return b.updateTime - a.updateTime;\n        });\n      }\n    }\n    return newDialog;\n  }\n\n  render() {\n    const { currentPeer, archive } = this.state;\n    const { Recent, DepSection, FooterSection } = this.components;\n    \n    return (\n      <aside className=\"sidebar\">\n        <Recent\n          currentPeer={currentPeer}\n          dialogs={this.filterDailogs()}\n          archive={archive}\n        />\n\n        <DepSection/>\n        <FooterSection/>\n      </aside>\n    );\n  }\n}\n\nexport default Container.create(Sidebar, { pure: false });\n"]}