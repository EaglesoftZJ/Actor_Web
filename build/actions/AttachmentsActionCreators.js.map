{"version":3,"sources":["../../src/actions/AttachmentsActionCreators.js"],"names":["sendAttachment","currentPeer","attachment","isAnimation","sendAsPicture","sendAnimationMessage","file","isImage","sendPhotoMessage","sendFileMessage","show","attachments","normalizedAttachments","map","File","type","includes","ATTACHMENT_MODAL_SHOW","toggleAutoFocus","hide","ATTACHMENT_MODAL_HIDE","selectAttachment","index","ATTACHMENT_SELECT","changeAttachment","ATTACHMENT_CHANGE","deleteAttachment","ATTACHMENT_DELETE","getAllAttachments","length","getCurrentPeer","getAttachment","ATTACHMENT_SEND","sendAll","forEach","ATTACHMENT_SEND_ALL"],"mappings":";;;;AAIA;;AACA;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;AACA;;;;;;AAEA,SAASA,eAAT,CAAwBC,WAAxB,EAAqCC,UAArC,EAAiD;AAC/C,MAAIA,WAAWC,WAAX,IAA0BD,WAAWE,aAAzC,EAAwD;AACtD,oCAAsBC,oBAAtB,CAA2CJ,WAA3C,EAAwDC,WAAWI,IAAnE;AACD,GAFD,MAEO,IAAIJ,WAAWK,OAAX,IAAsBL,WAAWE,aAArC,EAAoD;AACzD,oCAAsBI,gBAAtB,CAAuCP,WAAvC,EAAoDC,WAAWI,IAA/D;AACD,GAFM,MAEA;AACL,oCAAsBG,eAAtB,CAAsCR,WAAtC,EAAmDC,WAAWI,IAA9D;AACD;AACF,C,CAtBD;;;;kBAwBe;AACbI,MADa,gBACRC,WADQ,EACK;AAChB,QAAMC,wBAAwBD,YAAYE,GAAZ,CAAgB,UAACP,IAAD,EAAU;AACtD,UAAIA,gBAAgBQ,IAAhB,IAAwB,KAA5B,EAAmC;AACjCR,eAAO,0BAAWA,IAAX,CAAP;AACD;;AAED,aAAO;AACLC,iBAASD,KAAKS,IAAL,CAAUC,QAAV,CAAmB,OAAnB,CADJ;AAELb,qBAAaG,KAAKS,IAAL,KAAc,WAFtB;AAGLX,uBAAe,IAHV;AAILE;AAJK,OAAP;AAMD,KAX6B,CAA9B;;AAaA,sCAAS,+BAAYW,qBAArB,EAA4C,EAAEN,aAAaC,qBAAf,EAA5C;AACA,oCAAsBM,eAAtB,CAAsC,KAAtC;AACD,GAjBY;AAmBbC,MAnBa,kBAmBN;AACL,sCAAS,+BAAYC,qBAArB;AACA,oCAAsBF,eAAtB,CAAsC,IAAtC;AACD,GAtBY;AAwBbG,kBAxBa,4BAwBIC,KAxBJ,EAwBW;AACtB,sCAAS,+BAAYC,iBAArB,EAAwC,EAAED,YAAF,EAAxC;AACD,GA1BY;AA4BbE,kBA5Ba,4BA4BIpB,aA5BJ,EA4BmB;AAC9B,sCAAS,+BAAYqB,iBAArB,EAAwC,EAAErB,4BAAF,EAAxC;AACD,GA9BY;AAgCbsB,kBAhCa,8BAgCM;AACjB,sCAAS,+BAAYC,iBAArB;AACA,QAAI,2BAAiBC,iBAAjB,GAAqCC,MAArC,KAAgD,CAApD,EAAuD;AACrD,WAAKV,IAAL;AACD;AACF,GArCY;AAuCbnB,gBAvCa,4BAuCI;AACf,QAAMC,cAAc,sBAAY6B,cAAZ,EAApB;AACA,QAAM5B,aAAa,2BAAiB6B,aAAjB,EAAnB;;AAEA/B,oBAAeC,WAAf,EAA4BC,UAA5B;;AAEA,sCAAS,+BAAY8B,eAArB;;AAEA,QAAI,2BAAiBJ,iBAAjB,GAAqCC,MAArC,KAAgD,CAApD,EAAuD;AACrD,WAAKV,IAAL;AACD;;AAED,oCAAsBD,eAAtB,CAAsC,IAAtC;AACD,GApDY;AAsDbe,SAtDa,mBAsDLtB,WAtDK,EAsDQ;AACnB,QAAMV,cAAc,sBAAY6B,cAAZ,EAApB;;AAEAnB,gBAAYuB,OAAZ,CAAoB,UAAChC,UAAD,EAAgB;AAClCF,sBAAeC,WAAf,EAA4BC,UAA5B;AACD,KAFD;;AAIA,sCAAS,+BAAYiC,mBAArB,EAA0C,EAAExB,wBAAF,EAA1C;AACA,SAAKQ,IAAL;AACA,oCAAsBD,eAAtB,CAAsC,IAAtC;AACD;AAhEY,C","file":"AttachmentsActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\nimport blobToFile from '../utils/blobToFile';\n\nimport MessageActionCreators from './MessageActionCreators';\nimport ComposeActionCreators from '../actions/ComposeActionCreators';\n\nimport DialogStore from '../stores/DialogStore';\nimport AttachmentsStore from '../stores/AttachmentsStore';\n\nfunction sendAttachment(currentPeer, attachment) {\n  if (attachment.isAnimation && attachment.sendAsPicture) {\n    MessageActionCreators.sendAnimationMessage(currentPeer, attachment.file);\n  } else if (attachment.isImage && attachment.sendAsPicture) {\n    MessageActionCreators.sendPhotoMessage(currentPeer, attachment.file);\n  } else {\n    MessageActionCreators.sendFileMessage(currentPeer, attachment.file);\n  }\n}\n\nexport default {\n  show(attachments) {\n    const normalizedAttachments = attachments.map((file) => {\n      if (file instanceof File == false) {\n        file = blobToFile(file);\n      }\n\n      return {\n        isImage: file.type.includes('image'),\n        isAnimation: file.type === 'image/gif',\n        sendAsPicture: true,\n        file\n      }\n    });\n\n    dispatch(ActionTypes.ATTACHMENT_MODAL_SHOW, { attachments: normalizedAttachments });\n    ComposeActionCreators.toggleAutoFocus(false);\n  },\n\n  hide() {\n    dispatch(ActionTypes.ATTACHMENT_MODAL_HIDE);\n    ComposeActionCreators.toggleAutoFocus(true);\n  },\n\n  selectAttachment(index) {\n    dispatch(ActionTypes.ATTACHMENT_SELECT, { index })\n  },\n\n  changeAttachment(sendAsPicture) {\n    dispatch(ActionTypes.ATTACHMENT_CHANGE, { sendAsPicture });\n  },\n\n  deleteAttachment() {\n    dispatch(ActionTypes.ATTACHMENT_DELETE);\n    if (AttachmentsStore.getAllAttachments().length === 0) {\n      this.hide();\n    }\n  },\n\n  sendAttachment() {\n    const currentPeer = DialogStore.getCurrentPeer();\n    const attachment = AttachmentsStore.getAttachment();\n\n    sendAttachment(currentPeer, attachment);\n\n    dispatch(ActionTypes.ATTACHMENT_SEND);\n\n    if (AttachmentsStore.getAllAttachments().length === 0) {\n      this.hide();\n    }\n\n    ComposeActionCreators.toggleAutoFocus(true);\n  },\n\n  sendAll(attachments) {\n    const currentPeer = DialogStore.getCurrentPeer();\n\n    attachments.forEach((attachment) => {\n      sendAttachment(currentPeer, attachment);\n    });\n\n    dispatch(ActionTypes.ATTACHMENT_SEND_ALL, { attachments });\n    this.hide();\n    ComposeActionCreators.toggleAutoFocus(true);\n  }\n}\n"]}