{"version":3,"sources":["../../src/actions/AttachmentsActionCreators.js"],"names":["sendAttachment","currentPeer","attachment","isAnimation","sendAsPicture","sendAnimationMessage","file","isImage","sendPhotoMessage","sendFileMessage","show","attachments","normalizedAttachments","map","File","isOverSize","size","type","includes","ATTACHMENT_MODAL_SHOW","toggleAutoFocus","hide","ATTACHMENT_MODAL_HIDE","selectAttachment","index","ATTACHMENT_SELECT","changeAttachment","ATTACHMENT_CHANGE","deleteAttachment","ATTACHMENT_DELETE","getAllAttachments","length","getCurrentPeer","getAttachment","getStorePeer","console","log","ATTACHMENT_SEND","sendAll","forEach","ATTACHMENT_SEND_ALL"],"mappings":"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","file":"AttachmentsActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\nimport blobToFile from '../utils/blobToFile';\n\nimport MessageActionCreators from './MessageActionCreators';\nimport ComposeActionCreators from '../actions/ComposeActionCreators';\n\nimport DialogStore from '../stores/DialogStore';\nimport AttachmentsStore from '../stores/AttachmentsStore';\n\nfunction sendAttachment(currentPeer, attachment) {\n  if (attachment.isAnimation && attachment.sendAsPicture) {\n    MessageActionCreators.sendAnimationMessage(currentPeer, attachment.file);\n  } else if (attachment.isImage && attachment.sendAsPicture) {\n    MessageActionCreators.sendPhotoMessage(currentPeer, attachment.file);\n  } else {\n    MessageActionCreators.sendFileMessage(currentPeer, attachment.file);\n  }\n}\n\nexport default {\n  show(attachments) {\n    const normalizedAttachments = attachments.map((file) => {\n      if (file instanceof File == false) {\n        file = blobToFile(file);\n      }\n      var isOverSize = false;\n\n      if(file.size >= 10 * 1024 * 1024) {\n        isOverSize = true;\n      }\n      return {\n        isImage: file.type.includes('image'),\n        isAnimation: file.type === 'image/gif',\n        sendAsPicture: isOverSize ? false : true,\n        isOverSize,\n        file\n      }\n    });\n\n    dispatch(ActionTypes.ATTACHMENT_MODAL_SHOW, { attachments: normalizedAttachments });\n    ComposeActionCreators.toggleAutoFocus(false);\n  },\n\n  hide() {\n    dispatch(ActionTypes.ATTACHMENT_MODAL_HIDE);\n    ComposeActionCreators.toggleAutoFocus(true);\n  },\n\n  selectAttachment(index) {\n    dispatch(ActionTypes.ATTACHMENT_SELECT, { index })\n  },\n\n  changeAttachment(sendAsPicture) {\n    dispatch(ActionTypes.ATTACHMENT_CHANGE, { sendAsPicture });\n  },\n\n  deleteAttachment() {\n    dispatch(ActionTypes.ATTACHMENT_DELETE);\n    if (AttachmentsStore.getAllAttachments().length === 0) {\n      this.hide();\n    }\n  },\n\n  sendAttachment() {\n    var currentPeer = DialogStore.getCurrentPeer();\n    currentPeer = null;\n    var attachment = AttachmentsStore.getAttachment();\n    if (!currentPeer) {\n      \n      currentPeer =  DialogStore.getStorePeer();\n      console.log('storelog',currentPeer );\n    }\n\n    sendAttachment(currentPeer, attachment);\n\n    dispatch(ActionTypes.ATTACHMENT_SEND);\n\n    if (AttachmentsStore.getAllAttachments().length === 0) {\n      this.hide();\n    }\n\n    ComposeActionCreators.toggleAutoFocus(true);\n  },\n\n  sendAll(attachments) {\n    var currentPeer = DialogStore.getCurrentPeer();\n\n    if (!currentPeer) {\n      currentPeer =  DialogStore.getStorePeer();\n    }\n\n    attachments.forEach((attachment) => {\n      sendAttachment(currentPeer, attachment);\n    });\n\n    dispatch(ActionTypes.ATTACHMENT_SEND_ALL, { attachments });\n    this.hide();\n    ComposeActionCreators.toggleAutoFocus(true);\n  }\n}\n"]}