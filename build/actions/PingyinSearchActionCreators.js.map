{"version":3,"sources":["../../src/actions/PingyinSearchActionCreators.js"],"names":["show","DEPARTMENT_SHOW","toggleAutoFocus","hide","DEPARTMENT_HIDE","setPingyinSearchList","list","obj","from","where","toArray","item","peerInfo","title","peer","type","push","letterStore","make","pingYing","pingyin","letter","substring","toLowerCase","indexOf","key","test","sort","a","b","PINGYIN_SEARCH_CHANGED"],"mappings":";;;;AAIA;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;kBAEe;AACbA,MADa,kBACN;AACL,sCAAS,+BAAYC,eAArB;AACA,oCAAsBC,eAAtB,CAAsC,KAAtC;AACD,GAJY;AAMbC,MANa,kBAMN;AACL,sCAAS,+BAAYC,eAArB;AACA,oCAAsBF,eAAtB,CAAsC,IAAtC;AACD,GATY;AAWbG,sBAXa,gCAWQC,IAXR,EAWc;AACzB,QAAIC,MAAM,EAAC,MAAM,EAAP,EAAV;AACA;AACAD,WAAO,eAAKE,IAAL,CAAUF,IAAV,EAAgBG,KAAhB,CAAsB,yCAAtB,EAAiEC,OAAjE,EAAP;AACA,yBAAiBJ,IAAjB,kHAAuB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,UAAdK,IAAc;;AACrB,UAAI,CAACA,KAAKC,QAAL,CAAcC,KAAnB,EAA0B;AAC1B,UAAIF,KAAKC,QAAL,CAAcE,IAAd,CAAmBC,IAAnB,KAA4B,OAAhC,EAAyC;AACvCR,YAAI,IAAJ,EAAUS,IAAV,CAAeL,IAAf;AACA;AACD;AACD,UAAIM,cAAc,EAAlB;AACA,4BAAoB,iBAAOC,IAAP,CAAYC,QAAZ,CAAqBR,KAAKC,QAAL,CAAcC,KAAnC,CAApB,yHAA+D;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,YAAtDO,OAAsD;;AAC7D,YAAIC,SAASD,QAAQE,SAAR,CAAkB,CAAlB,EAAqB,CAArB,EAAwBC,WAAxB,EAAb;AACA,YAAIN,YAAYO,OAAZ,CAAoBH,MAApB,MAAgC,CAAC,CAArC,EAAwC;AACtC;AACD,SAFD,MAEO;AACLJ,sBAAYD,IAAZ,CAAiBK,MAAjB;AACD;AACD,YAAII,OAAM,EAAV;AACAA,eAAM,QAAQC,IAAR,CAAaL,MAAb,IAAuBA,MAAvB,GAAgC,GAAtC;AACA,YAAI,CAACd,IAAIkB,IAAJ,CAAL,EAAe;AACblB,cAAIkB,IAAJ,IAAW,EAAX;AACD;AACDlB,YAAIkB,IAAJ,EAAST,IAAT,CAAcL,IAAd;AACD;AACF;AACD,SAAK,IAAIc,GAAT,IAAgBlB,GAAhB,EAAqB;AACnBA,UAAIkB,GAAJ,EAASE,IAAT,CAAc,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACtB,YAAID,EAAEhB,QAAF,CAAWC,KAAX,GAAmBgB,EAAEjB,QAAF,CAAWC,KAAlC,EAAyC;AACvC,iBAAO,CAAP;AACD,SAFD,MAEO,IAAIe,EAAEhB,QAAF,CAAWC,KAAX,GAAmBgB,EAAEjB,QAAF,CAAWC,KAAlC,EAAyC;AAC9C,iBAAO,CAAP;AACD,SAFM,MAEA;AACL,iBAAO,CAAC,CAAR;AACD;AACF,OARD;AASD;AACD,sCAAS,+BAAYiB,sBAArB,EAA6C,EAAEvB,QAAF,EAA7C;AACD;AAjDY,C,EAVf","file":"PingyinSearchActionCreators.js","sourcesContent":["/*\r\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { dispatch } from '../dispatcher/ActorAppDispatcher';\r\nimport { ActionTypes } from '../constants/ActorAppConstants';\r\nimport ComposeActionCreators from '../actions/ComposeActionCreators';\r\nimport makepy from 'makepy';\r\nimport linq from 'Linq';\r\n\r\nexport default {\r\n  show() {\r\n    dispatch(ActionTypes.DEPARTMENT_SHOW);\r\n    ComposeActionCreators.toggleAutoFocus(false);\r\n  },\r\n\r\n  hide() {\r\n    dispatch(ActionTypes.DEPARTMENT_HIDE);\r\n    ComposeActionCreators.toggleAutoFocus(true);\r\n  },\r\n  \r\n  setPingyinSearchList(list) {\r\n    let obj = {'群组': []};\r\n    // 过滤系统管理员\r\n    list = linq.from(list).where('$.peerInfo.title.indexOf(\"系统管理员\") == -1').toArray();\r\n    for (let item of list) {\r\n      if (!item.peerInfo.title) continue;\r\n      if (item.peerInfo.peer.type === 'group') {\r\n        obj['群组'].push(item);\r\n        continue;\r\n      }\r\n      let letterStore = [];\r\n      for (let pingyin of makepy.make.pingYing(item.peerInfo.title)) {\r\n        let letter = pingyin.substring(0, 1).toLowerCase();\r\n        if (letterStore.indexOf(letter) !== -1) {\r\n          continue;\r\n        } else {\r\n          letterStore.push(letter);\r\n        }\r\n        let key = '';\r\n        key = /[a-z]/.test(letter) ? letter : '#';\r\n        if (!obj[key]) {\r\n          obj[key] = [];\r\n        } \r\n        obj[key].push(item);\r\n      }\r\n    }\r\n    for (let key in obj) {\r\n      obj[key].sort((a, b) => {\r\n        if (a.peerInfo.title > b.peerInfo.title) {\r\n          return 1;\r\n        } else if (a.peerInfo.title > b.peerInfo.title) {\r\n          return 0;\r\n        } else {\r\n          return -1;\r\n        }\r\n      })\r\n    }\r\n    dispatch(ActionTypes.PINGYIN_SEARCH_CHANGED, { obj });\r\n  }\r\n};\r\n"]}