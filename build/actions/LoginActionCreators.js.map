{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":["LoginActionCreators","start","AUTH_START","changeLogin","login","AUTH_CHANGE_LOGIN","changeCode","code","AUTH_CHANGE_CODE","changeName","name","AUTH_CHANGE_NAME","changeRemember","remember","AUTH_CHANGE_REMEMBER","changeAuto","auto","AUTH_CHANGE_AUTO","changeNameList","list","AUTH_CHANGE_NAME_LIST","startSignup","AUTH_SIGNUP_START","restartAuth","AUTH_RESTART","requestCode","phone","promise","test","requestCodeEmail","requestSms","request","AUTH_CODE_REQUEST","success","AUTH_CODE_REQUEST_SUCCESS","failure","AUTH_CODE_REQUEST_FAILURE","requestNickName","nickname","reslove","reject","AUTH_USER_REQUEST","AUTH_USER_REQUEST_SUCCESS","AUTH_USER_REQUEST_FAILURE","then","state","sendCode","AUTH_CODE_SEND","AUTH_CODE_SEND_SUCCESS","AUTH_CODE_SEND_FAILURE","setLoggedIn","redirect","console","error","sendPassword","password","AUTH_PASSWORD_SEND","AUTH_PASSWORD_SEND_SUCCESS","AUTH_PASSWORD_SEND_FAILURE","sendSignup","signUpPromise","signUp","AUTH_SIGNUP","AUTH_SIGNUP_SUCCESS","AUTH_SIGNUP_FAILURE","opts","delegate","get","actions","AUTH_SET_LOGGED_SET_STORE","location","nextPathname","push","setBindings","bindUser","getUid","setProfile","bindGroupDialogs","setDialogs","bindContacts","setContacts","bindSearch","setQuickSearchList","bindTempGlobalCounter","setFavicon","bindEventBus","broadcastEvent","bindStickers","setStickers","AUTH_SET_LOGGED_IN","postOAWebservice","url","data","setRes","res","setLoggedOut","keepAuto","removeBindings","AUTH_SET_LOGGED_OUT"],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes } from '../constants/ActorAppConstants';\n\nimport ActorClient from '../utils/ActorClient';\nimport history from '../utils/history';\nimport DelegateContainer from '../utils/DelegateContainer';\nimport LocationContainer from '../utils/LocationContainer';\n\nimport ActionCreators from './ActionCreators';\nimport JoinGroupActions from './JoinGroupActions';\nimport ProfileActionCreators from './ProfileActionCreators';\nimport DialogActionCreators from './DialogActionCreators';\nimport ContactActionCreators from './ContactActionCreators';\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\nimport FaviconActionCreators from './FaviconActionCreators';\nimport EventBusActionCreators from './EventBusActionCreators';\nimport StickersActionCreators from './StickersActionCreators';\nimport DepartmentActionCreators from './DepartmentActionCreators';\n\nclass LoginActionCreators extends ActionCreators {\n  start() {\n    dispatch(ActionTypes.AUTH_START);\n  }\n\n  changeLogin(login) {\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login });\n  }\n\n  changeCode(code) {\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code });\n  }\n\n  changeName(name) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name });\n  }\n\n  changeRemember(remember) {\n    dispatch(ActionTypes.AUTH_CHANGE_REMEMBER, { remember });\n  }\n\n  changeAuto(auto) {\n    dispatch(ActionTypes.AUTH_CHANGE_AUTO, { auto });\n  }\n\n  changeNameList(list) {\n    dispatch(ActionTypes.AUTH_CHANGE_NAME_LIST, { list });\n  }\n\n  startSignup() {\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\n  }\n\n  restartAuth() {\n    dispatch(ActionTypes.AUTH_RESTART);\n  }\n\n  requestCode(phone) {\n    let promise;\n    if (/@/.test(phone)) {\n      promise = ActorClient.requestCodeEmail(phone);\n    } else {\n      promise = ActorClient.requestSms(phone);\n    }\n\n    dispatchAsync(promise, {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  requestSms(phone) {\n    dispatchAsync(ActorClient.requestSms(phone), {\n      request: ActionTypes.AUTH_CODE_REQUEST,\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\n    }, { phone });\n  }\n\n  requestNickName(nickname, reslove, reject) {\n   dispatchAsync(ActorClient.requestNickName(nickname), {\n      request: ActionTypes.AUTH_USER_REQUEST,\n      success: ActionTypes.AUTH_USER_REQUEST_SUCCESS,\n      failure: ActionTypes.AUTH_USER_REQUEST_FAILURE\n    }, {\n      nickname\n    }).then((state) => {\n     switch (state) {\n       case 'start':\n         reslove();\n       break;\n       default:\n         reject();\n     }\n    })\n  }\n\n  sendCode(code) {\n    dispatchAsync(ActorClient.sendCode(code), {\n      request: ActionTypes.AUTH_CODE_SEND,\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\n    }, {\n      code\n    }).then((state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({ redirect: true });\n          break;\n        default:\n          console.error('Unsupported state', state);\n      }\n    });\n  }\n\n  sendPassword(password, reslove, reject) {\n    dispatchAsync(ActorClient.sendPassword(password), {\n      request: ActionTypes.AUTH_PASSWORD_SEND,\n      success: ActionTypes.AUTH_PASSWORD_SEND_SUCCESS,\n      failure: ActionTypes.AUTH_PASSWORD_SEND_FAILURE\n    }, {\n      password\n    }).then((state) => {\n      switch (state) {\n        case 'signup':\n          this.startSignup();\n          break;\n        case 'logged_in':\n          this.setLoggedIn({ redirect: true });\n          break;\n        default:\n          reject();\n          console.error('Unsupported state', state);\n      }\n    });\n  }\n\n  sendSignup(name) {\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\n      request: ActionTypes.AUTH_SIGNUP,\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\n    }, { name });\n\n    const setLoggedIn = () => this.setLoggedIn({ redirect: true });\n\n    signUpPromise()\n      .then(setLoggedIn)\n  }\n\n\n\n  setLoggedIn(opts = {}) {\n    const delegate = DelegateContainer.get();\n\n    if (delegate.actions.setLoggedIn) {\n      return delegate.actions.setLoggedIn(opts);\n    }\n\n    if (opts.redirect) {\n      dispatch(ActionTypes.AUTH_SET_LOGGED_SET_STORE);\n      const location = LocationContainer.get();\n      const nextPathname = location.state ? location.state.nextPathname : '/im';\n\n      history.push(nextPathname);\n    }\n\n    this.setBindings('main', [\n      ActorClient.bindUser(ActorClient.getUid(), ProfileActionCreators.setProfile),\n      ActorClient.bindGroupDialogs(DialogActionCreators.setDialogs),\n      ActorClient.bindContacts(ContactActionCreators.setContacts),\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList),\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon),\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent),\n      ActorClient.bindStickers(StickersActionCreators.setStickers)\n    ]);\n\n\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\n\n    ActorClient.postOAWebservice({\n      //url: 'http://g.portzhoushan.com/MoaService/MoaService.asmx/GetAllUserFullData',\n      url: 'http://61.175.100.14:8004/WebServiceSSO.asmx/GetAllUserFullData',\n      // url: 'http://220.189.207.21:8709/WebServiceSSO.asmx/GetAllUserFullData',\n      data: 'k=eagleSoftWebService',\n      success: res => {\n        DepartmentActionCreators.setRes({res});\n      }\n    });\n    // JoinGroupActions.joinAfterLogin();\n  }\n\n  setLoggedOut(keepAuto) {\n    const delegate = DelegateContainer.get();\n\n\n\n    if (delegate.actions.setLoggedOut) {\n      return delegate.actions.setLoggedOut();\n    }\n\n    this.removeBindings('main');\n\n    dispatch(ActionTypes.AUTH_SET_LOGGED_OUT,{keepAuto: keepAuto?true:false});\n  }\n}\n\nexport default new LoginActionCreators();\n"]}