{"version":3,"sources":["../../src/stores/ComposeStore.js"],"names":["ComposeStore","getInitialState","text","mentions","commands","autoFocus","editMessage","reduce","state","action","type","COMPOSE_CLEAN","BIND_DIALOG_PEER","COMPOSE_TYPING","nextState","peer","GROUP","query","caretPosition","findMentions","id","command","findBotCommands","name","MESSAGES_EDIT_START","message","content","MESSAGES_EDIT_END","COMPOSE_MENTION_INSERT","console","error","mentionEnding","atStart","textBeforeMention","substring","length","textAfterMention","mention","mentionText","COMPOSE_MENTION_CLOSE","DRAFT_LOAD","draft","EMOJI_INSERT","textBeforeEmoji","textAfterEmoji","emoji","COMPOSE_PASTE","COMPOSE_TOGGLE_AUTO_FOCUS","isEnable","SEARCH_TOGGLE_FOCUS"],"mappings":"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","file":"ComposeStore.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport { ReduceStore } from 'flux/utils';\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\nimport { ActionTypes, PeerTypes } from '../constants/ActorAppConstants';\nimport ActorClient from '../utils/ActorClient';\nimport { parseMentionQuery, parseBotCommand } from '../utils/ComposeUtils';\n\nclass ComposeStore extends ReduceStore {\n  getInitialState() {\n    return {\n      text: '',\n      mentions: null,\n      commands: null,\n      autoFocus: true,\n      editMessage: null\n    };\n  }\n\n  reduce(state, action) {\n    switch (action.type) {\n      case ActionTypes.COMPOSE_CLEAN:\n      case ActionTypes.BIND_DIALOG_PEER:\n        return this.getInitialState();\n\n      case ActionTypes.COMPOSE_TYPING:\n        const nextState = {\n          ...state,\n          text: action.text,\n          commands: null,\n          mentions: null\n        };\n\n        if (action.peer.type === PeerTypes.GROUP) {\n          const query = parseMentionQuery(action.text, action.caretPosition);\n          if (query) {\n            nextState.mentions = ActorClient.findMentions(action.peer.id, query.text);\n          }\n        } else {\n          const command = parseBotCommand(action.text);\n          if (command) {\n            nextState.commands = ActorClient.findBotCommands(action.peer.id, command.name || '');\n          }\n        }\n\n        return nextState;\n\n      case ActionTypes.MESSAGES_EDIT_START:\n        return {\n          ...state,\n          text: action.message.content.text,\n          editMessage: action.message\n        };\n\n      case ActionTypes.MESSAGES_EDIT_END:\n        return {\n          ...state,\n          text: '',\n          editMessage: null\n        };\n\n      case ActionTypes.COMPOSE_MENTION_INSERT:\n        const query = parseMentionQuery(action.text, action.caretPosition);\n        if (!query) {\n          console.error('Mention not found', { state, action });\n          return state;\n        }\n\n        const mentionEnding = query.atStart ? ': ' : ' ';\n        const textBeforeMention = action.text.substring(0, action.caretPosition - query.text.length - 1);\n        const textAfterMention = action.text.substring(action.caretPosition, action.text.length);\n\n        return {\n          ...state,\n          text: textBeforeMention + action.mention.mentionText + mentionEnding + textAfterMention,\n          mentions: null\n        };\n\n      case ActionTypes.COMPOSE_MENTION_CLOSE:\n        return {\n          ...state,\n          mentions: null\n        };\n\n      case ActionTypes.DRAFT_LOAD:\n        return {\n          ...state,\n          text: action.draft\n        };\n\n      case ActionTypes.EMOJI_INSERT:\n        const textBeforeEmoji = action.text.substring(0, action.caretPosition);\n        const textAfterEmoji = action.text.substring(action.caretPosition, action.text.length);\n\n        return {\n          ...state,\n          text: textBeforeEmoji + action.emoji + ' ' + textAfterEmoji\n        };\n\n      case ActionTypes.COMPOSE_PASTE:\n        return {\n          ...state,\n          text: action.text\n        };\n\n      case ActionTypes.COMPOSE_TOGGLE_AUTO_FOCUS:\n        return {\n          ...state,\n          autoFocus: action.isEnable\n        };\n\n      case ActionTypes.SEARCH_TOGGLE_FOCUS:\n        return {\n          ...state,\n          autoFocus: !action.isEnable\n        };\n\n      default:\n        return state;\n    }\n  }\n}\n\nexport default new ComposeStore(Dispatcher);\n"]}